<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sekhar Financial Services â€“ Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:#0a1628; --navy-mid:#112240; --navy-light:#1a3460;
  --gold:#c9a84c; --gold-light:#e8c878; --gold-pale:#f5e9c8;
  --cream:#faf7f0; --text:#1a1a2e; --text-mid:#3d3d5c; --text-light:#6b6b8a;
  --border:#e2d9c5; --white:#ffffff; --section-bg:#f8f5ee;
  --green:#2d6a4f; --red:#c62828; --orange:#e65100;
  --shadow:0 2px 20px rgba(10,22,40,0.08);
  --shadow-lg:0 8px 40px rgba(10,22,40,0.15);
  --shadow-gold:0 4px 30px rgba(201,168,76,0.2);
  --radius:12px; --radius-sm:8px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--text);min-height:100vh;}

/* â•â•â•â• SCREENS â€” Login redirect bug fix â•â•â•â•
   FIX: Never put display: on the ID selector. 
   Previously #screen-landing had display:flex which beat .screen{display:none}
   because ID specificity (0,1,0,0) > class (0,0,1,0). Fixed below. */
.screen{display:none;min-height:100vh;}
.screen.active{display:block;}
.screen.active#screen-landing{display:flex;flex-direction:column;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDING / LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-landing{
  background:linear-gradient(135deg,var(--navy) 0%,#1a3460 60%,#0f2040 100%);
}
.landing-hero{
  flex:1;display:flex;align-items:center;justify-content:center;
  padding:40px 20px;position:relative;overflow:hidden;
}
.landing-hero::before{
  content:'';position:absolute;inset:0;
  background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c9a84c' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
.landing-card{
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(20px);
  border:1px solid rgba(201,168,76,0.2);
  border-radius:20px;
  padding:48px;
  max-width:460px;width:100%;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
  position:relative;z-index:1;
}
.landing-logo{text-align:center;margin-bottom:32px;}
.landing-logo .badge{
  width:72px;height:72px;
  background:linear-gradient(135deg,var(--gold),var(--gold-light));
  border-radius:18px;display:inline-flex;
  align-items:center;justify-content:center;
  font-family:'Playfair Display',serif;font-size:28px;
  font-weight:700;color:var(--navy);
  box-shadow:0 8px 24px rgba(201,168,76,0.4);
  margin-bottom:16px;
}
.landing-logo h1{font-family:'Playfair Display',serif;color:var(--white);font-size:22px;font-weight:700;}
.landing-logo p{color:var(--gold);font-size:10.5px;letter-spacing:2.5px;text-transform:uppercase;margin-top:4px;}
.landing-tabs{display:flex;gap:0;margin-bottom:28px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.1);}
.landing-tab{flex:1;padding:10px;text-align:center;font-size:13px;font-weight:600;cursor:pointer;transition:all 0.2s;color:rgba(255,255,255,0.5);background:transparent;}
.landing-tab.active{background:var(--gold);color:var(--navy);}
.tab-panel{display:none;}
.tab-panel.active{display:block;}
.form-group{margin-bottom:16px;}
.form-group label{display:block;font-size:11px;font-weight:600;color:rgba(255,255,255,0.5);letter-spacing:0.5px;text-transform:uppercase;margin-bottom:6px;}
.form-group input{
  width:100%;padding:11px 14px;
  background:rgba(255,255,255,0.06);
  border:1.5px solid rgba(255,255,255,0.12);
  border-radius:8px;color:var(--white);
  font-size:14px;font-family:'DM Sans',sans-serif;
  outline:none;transition:all 0.2s;
}
.form-group input:focus{border-color:var(--gold);background:rgba(255,255,255,0.09);}
.form-group input::placeholder{color:rgba(255,255,255,0.25);}
.auth-btn{
  width:100%;padding:13px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--gold),var(--gold-light));
  color:var(--navy);font-size:14px;font-weight:700;
  border-radius:8px;letter-spacing:0.3px;
  font-family:'DM Sans',sans-serif;
  transition:all 0.2s;box-shadow:var(--shadow-gold);
  margin-top:4px;
}
.auth-btn:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(201,168,76,0.4);}
.auth-msg{margin-top:12px;font-size:12.5px;text-align:center;min-height:20px;}
.auth-msg.err{color:#ff6b6b;}.auth-msg.ok{color:#69db7c;}
.privacy-note{
  margin-top:20px;padding:14px;
  background:rgba(201,168,76,0.06);
  border:1px solid rgba(201,168,76,0.15);
  border-radius:8px;font-size:11.5px;
  color:rgba(255,255,255,0.45);line-height:1.6;text-align:center;
}
.privacy-note strong{color:var(--gold);}
.landing-footer{
  padding:16px 32px;text-align:center;
  border-top:1px solid rgba(255,255,255,0.06);
  font-size:11px;color:rgba(255,255,255,0.25);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP (USER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-app{background:var(--cream);}
.app-header{
  background:var(--navy);position:sticky;top:0;z-index:200;
  box-shadow:0 2px 30px rgba(0,0,0,0.3);
}
.header-inner{
  max-width:1280px;margin:0 auto;
  padding:14px 28px;
  display:flex;align-items:center;justify-content:space-between;
}
.logo-block{display:flex;align-items:center;gap:12px;}
.logo-icon{
  width:42px;height:42px;
  background:linear-gradient(135deg,var(--gold),var(--gold-light));
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--navy);
}
.logo-text h1{font-family:'Playfair Display',serif;color:var(--white);font-size:17px;font-weight:700;}
.logo-text p{color:var(--gold);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;margin-top:1px;}
.header-right{display:flex;align-items:center;gap:16px;}
.user-pill{
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(201,168,76,0.2);
  border-radius:20px;padding:6px 14px;
  font-size:12.5px;color:rgba(255,255,255,0.7);
  display:flex;align-items:center;gap:8px;
}
.user-pill .dot{width:7px;height:7px;background:#4caf50;border-radius:50%;}
.plan-badge{
  padding:4px 12px;border-radius:20px;font-size:10.5px;font-weight:700;
  letter-spacing:0.5px;text-transform:uppercase;
}
.plan-free{background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.5);}
.plan-premium{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);}
.btn-logout{
  background:transparent;border:1px solid rgba(255,255,255,0.15);
  color:rgba(255,255,255,0.5);padding:6px 14px;border-radius:6px;
  font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif;
  transition:all 0.2s;
}
.btn-logout:hover{border-color:var(--gold);color:var(--gold);}
.save-indicator{font-size:11px;color:rgba(255,255,255,0.3);display:flex;align-items:center;gap:6px;}
.save-dot{width:6px;height:6px;border-radius:50%;background:#4caf50;}
.save-dot.saving{background:var(--gold);animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* PROGRESS NAV */
.progress-nav{background:var(--navy-mid);border-bottom:1px solid rgba(201,168,76,0.15);overflow-x:auto;}
.progress-nav-inner{max-width:1280px;margin:0 auto;padding:0 28px;display:flex;min-width:max-content;}
.nav-step{padding:10px 13px;font-size:10px;font-weight:600;letter-spacing:0.5px;color:rgba(255,255,255,0.35);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap;text-transform:uppercase;}
.nav-step:hover{color:var(--gold-light);}
.nav-step.active{color:var(--gold);border-bottom-color:var(--gold);}
.nav-step.done{color:rgba(255,255,255,0.55);}
.nav-step.done::before{content:'âœ“ ';color:var(--gold);}

/* SECTIONS */
.app-body{max-width:1280px;margin:0 auto;padding:24px 28px;}
.section-card{background:var(--white);border-radius:14px;border:1px solid var(--border);margin-bottom:20px;overflow:hidden;box-shadow:var(--shadow);display:none;}
.section-card.active{display:block;animation:fadeUp 0.3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.section-header{background:linear-gradient(135deg,var(--navy) 0%,var(--navy-mid) 100%);padding:20px 28px;display:flex;align-items:center;gap:12px;}
.section-icon{width:38px;height:38px;background:rgba(201,168,76,0.12);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;border:1px solid rgba(201,168,76,0.25);}
.section-title{color:var(--white);}
.section-title h2{font-family:'Playfair Display',serif;font-size:17px;font-weight:600;}
.section-title p{color:rgba(255,255,255,0.45);font-size:11px;margin-top:2px;}
.section-body{padding:26px 28px;}

/* FORM */
.form-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.form-grid-2{grid-template-columns:repeat(2,1fr);}
.form-grid-4{grid-template-columns:repeat(4,1fr);}
.span-2{grid-column:span 2;}.span-3{grid-column:span 3;}
.field{display:flex;flex-direction:column;gap:5px;}
.field label{font-size:10.5px;font-weight:600;color:var(--text-mid);letter-spacing:0.3px;text-transform:uppercase;}
.field input,.field select,.field textarea{
  border:1.5px solid var(--border);border-radius:7px;
  padding:9px 12px;font-size:13.5px;
  font-family:'DM Sans',sans-serif;color:var(--text);
  background:var(--white);transition:all 0.2s;outline:none;width:100%;
}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,0.1);}
.field textarea{resize:vertical;min-height:70px;}
.rupee-field{position:relative;}
.rupee-field .rs{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--gold);font-weight:600;font-size:13px;pointer-events:none;}
.rupee-field input{padding-left:24px;}
.pct-field{position:relative;}
.pct-field .pc{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:var(--text-light);font-size:12px;}
.pct-field input{padding-right:24px;}

.divider{height:1px;background:var(--border);margin:20px 0;}
.sub-heading{font-family:'Playfair Display',serif;font-size:14px;color:var(--navy);margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.sub-heading span{color:var(--gold);}
.check-group{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
.check-item{display:flex;align-items:center;gap:5px;cursor:pointer;}
.check-item input{width:14px;height:14px;accent-color:var(--gold);cursor:pointer;}
.check-item label{font-size:12.5px;color:var(--text-mid);cursor:pointer;font-weight:400;text-transform:none;letter-spacing:0;}

/* BUTTONS */
.btn-row{display:flex;justify-content:space-between;align-items:center;margin-top:24px;gap:12px;}
.btn{padding:10px 24px;border-radius:7px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all 0.2s;font-family:'DM Sans',sans-serif;}
.btn-primary{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);box-shadow:var(--shadow-gold);}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(201,168,76,0.35);}
.btn-outline{background:transparent;border:1.5px solid var(--border);color:var(--text-mid);}
.btn-outline:hover{border-color:var(--gold);color:var(--gold);}
.btn-generate{background:linear-gradient(135deg,var(--navy),#1a3460);color:var(--gold-light);font-size:14px;padding:13px 36px;border-radius:9px;border:1px solid rgba(201,168,76,0.3);box-shadow:0 4px 20px rgba(10,22,40,0.25);}
.btn-generate:hover{transform:translateY(-1px);}
.btn-add{background:rgba(201,168,76,0.08);border:1.5px dashed var(--gold);color:var(--gold);cursor:pointer;padding:7px 16px;border-radius:7px;font-size:12px;font-weight:600;transition:all 0.2s;}
.btn-add:hover{background:rgba(201,168,76,0.16);}
.btn-del{background:#fff5f5;border:1px solid #ffcdd2;color:var(--red);padding:4px 9px;border-radius:5px;font-size:11px;cursor:pointer;}
.btn-save-section{background:#e8f5e9;border:1px solid #a5d6a7;color:var(--green);padding:8px 18px;border-radius:7px;font-size:12.5px;font-weight:600;cursor:pointer;transition:all 0.2s;}
.btn-save-section:hover{background:#c8e6c9;}

/* INFO BOXES */
.info-box{background:#e8f4fd;border:1px solid #b3d9f5;border-radius:8px;padding:11px 14px;font-size:12px;color:#1565c0;margin-bottom:16px;}
.warn-box{background:#fff3e0;border:1px solid #ffcc80;border-radius:8px;padding:11px 14px;font-size:12px;color:var(--orange);margin-bottom:16px;}
.success-box{background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:11px 14px;font-size:12px;color:var(--green);margin-bottom:16px;}

/* GOAL ROWS */
.goal-row{background:var(--section-bg);border-radius:9px;padding:16px;margin-bottom:12px;border:1px solid var(--border);}
.goal-label{font-family:'Playfair Display',serif;font-size:13px;color:var(--navy);margin-bottom:10px;font-weight:600;}

/* PORTFOLIO TABLE */
.ptable{width:100%;border-collapse:collapse;font-size:12px;}
.ptable th{background:var(--navy);color:var(--white);padding:8px 11px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;white-space:nowrap;}
.ptable td{padding:7px 11px;border-bottom:1px solid var(--border);vertical-align:middle;}
.ptable td input,.ptable td select{border:1px solid var(--border);border-radius:5px;padding:5px 8px;font-size:12px;font-family:'DM Sans',sans-serif;width:100%;outline:none;}
.ptable td input:focus,.ptable td select:focus{border-color:var(--gold);}

/* EDU TABLE */
.edu-table{width:100%;border-collapse:collapse;font-size:12px;}
.edu-table th{background:linear-gradient(135deg,var(--navy-mid),var(--navy));color:var(--white);padding:8px 11px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:0.4px;}
.edu-table td{padding:7px 11px;border-bottom:1px solid var(--border);}
.edu-table td input{border:1px solid var(--border);border-radius:5px;padding:5px 8px;font-size:12px;width:100%;outline:none;}
.edu-table td input:focus{border-color:var(--gold);}
.edu-table tr:nth-child(even) td{background:#fafaf8;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD SCREEN (USER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-dashboard{background:var(--cream);}
.dash-header{background:var(--navy);padding:0;box-shadow:0 2px 20px rgba(0,0,0,0.2);}
.dash-header-inner{max-width:1280px;margin:0 auto;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;}
.dash-body{max-width:1280px;margin:0 auto;padding:28px;}
.dash-welcome{margin-bottom:28px;}
.dash-welcome h2{font-family:'Playfair Display',serif;font-size:24px;color:var(--navy);}
.dash-welcome p{color:var(--text-light);font-size:13.5px;margin-top:4px;}
.dash-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px;}
.dash-card{background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:var(--shadow);}
.dash-card.gold{border-left:4px solid var(--gold);}
.dash-card.green{border-left:4px solid #4caf50;}
.dash-card.blue{border-left:4px solid #2196f3;}
.dash-card.red{border-left:4px solid var(--red);}
.dash-card .dc-label{font-size:10.5px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);font-weight:600;}
.dash-card .dc-value{font-family:'DM Mono',monospace;font-size:22px;color:var(--navy);margin:6px 0 4px;}
.dash-card .dc-sub{font-size:11px;color:var(--text-light);}
.dash-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:28px;}
.dash-action-btn{
  background:var(--white);border:1px solid var(--border);border-radius:12px;
  padding:20px 24px;cursor:pointer;text-align:left;transition:all 0.2s;
  display:flex;align-items:center;gap:16px;
  font-family:'DM Sans',sans-serif;
}
.dash-action-btn:hover{border-color:var(--gold);box-shadow:var(--shadow-gold);transform:translateY(-2px);}
.dash-action-btn .icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.dash-action-btn .icon.gold{background:rgba(201,168,76,0.12);}
.dash-action-btn .icon.blue{background:#e3f2fd;}
.dash-action-btn .icon.green{background:#e8f5e9;}
.dash-action-btn .icon.purple{background:#f3e5f5;}
.dash-action-btn h3{font-size:14px;font-weight:600;color:var(--navy);margin-bottom:3px;}
.dash-action-btn p{font-size:12px;color:var(--text-light);}
.privacy-banner{
  background:linear-gradient(135deg,var(--navy),#1a3460);
  border-radius:12px;padding:20px 24px;margin-bottom:20px;
  display:flex;align-items:center;gap:16px;
}
.privacy-banner .pb-icon{font-size:28px;}
.privacy-banner h3{color:var(--gold-light);font-family:'Playfair Display',serif;font-size:15px;margin-bottom:3px;}
.privacy-banner p{color:rgba(255,255,255,0.5);font-size:12px;line-height:1.6;}
.report-history{background:var(--white);border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:var(--shadow);}
.rh-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.rh-header h3{font-family:'Playfair Display',serif;font-size:15px;color:var(--navy);}
.rh-item{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;transition:background 0.15s;}
.rh-item:hover{background:var(--section-bg);}
.rh-item:last-child{border-bottom:none;}
.rh-item .ri-name{font-size:13.5px;font-weight:600;color:var(--navy);}
.rh-item .ri-date{font-size:11.5px;color:var(--text-light);margin-top:2px;}
.rh-item .ri-score{font-family:'DM Mono',monospace;font-size:13px;font-weight:600;color:var(--gold);}
.rh-item .ri-actions{display:flex;gap:8px;}
.btn-view{background:var(--navy);color:var(--white);border:none;padding:5px 12px;border-radius:5px;font-size:11.5px;cursor:pointer;font-family:'DM Sans',sans-serif;}
.btn-view:hover{background:var(--navy-light);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-admin{background:#f0f2f5;}
.admin-sidebar{
  position:fixed;left:0;top:0;bottom:0;width:240px;
  background:var(--navy);z-index:100;
  display:flex;flex-direction:column;
  box-shadow:4px 0 20px rgba(0,0,0,0.15);
}
.admin-logo{padding:24px 20px;border-bottom:1px solid rgba(255,255,255,0.08);}
.admin-logo .badge{width:36px;height:36px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:8px;display:inline-flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:16px;font-weight:700;color:var(--navy);margin-bottom:8px;}
.admin-logo h1{color:var(--white);font-size:14px;font-weight:700;font-family:'Playfair Display',serif;}
.admin-logo p{color:rgba(255,255,255,0.3);font-size:10px;letter-spacing:1px;text-transform:uppercase;margin-top:2px;}
.admin-nav{flex:1;padding:12px 0;overflow-y:auto;}
.admin-nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;color:rgba(255,255,255,0.45);cursor:pointer;transition:all 0.2s;font-size:13px;font-weight:500;}
.admin-nav-item:hover{color:var(--white);background:rgba(255,255,255,0.05);}
.admin-nav-item.active{color:var(--gold);background:rgba(201,168,76,0.08);border-right:3px solid var(--gold);}
.admin-nav-item .nav-icon{font-size:16px;width:20px;text-align:center;}
.admin-footer{padding:16px 20px;border-top:1px solid rgba(255,255,255,0.08);}
.admin-main{margin-left:240px;min-height:100vh;display:flex;flex-direction:column;}
.admin-topbar{background:var(--white);padding:0 28px;height:60px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);box-shadow:0 1px 4px rgba(0,0,0,0.05);position:sticky;top:0;z-index:50;}
.admin-topbar h2{font-family:'Playfair Display',serif;font-size:18px;color:var(--navy);}
.admin-topbar-right{display:flex;align-items:center;gap:14px;}
.admin-badge{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:0.5px;}
.admin-content{flex:1;padding:28px;}
.admin-panel{display:none;}
.admin-panel.active{display:block;animation:fadeUp 0.25s ease;}

/* ADMIN STATS */
.admin-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-bottom:28px;}
.stat-card{background:var(--white);border-radius:12px;padding:18px 20px;border:1px solid var(--border);box-shadow:0 1px 4px rgba(0,0,0,0.04);}
.stat-card .sc-icon{font-size:24px;margin-bottom:8px;}
.stat-card .sc-label{font-size:10.5px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);font-weight:600;}
.stat-card .sc-value{font-family:'DM Mono',monospace;font-size:28px;color:var(--navy);font-weight:500;margin:4px 0;}
.stat-card .sc-change{font-size:11px;color:var(--green);}

/* ADMIN TABLE */
.admin-table-wrap{background:var(--white);border-radius:12px;border:1px solid var(--border);overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,0.04);}
.admin-table-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.admin-table-header h3{font-family:'Playfair Display',serif;font-size:15px;color:var(--navy);}
.admin-search{padding:8px 14px;border:1px solid var(--border);border-radius:7px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none;width:220px;}
.admin-search:focus{border-color:var(--gold);}
.atable{width:100%;border-collapse:collapse;font-size:12.5px;}
.atable th{background:#f8f9fa;color:var(--text-mid);padding:10px 14px;text-align:left;font-size:10.5px;text-transform:uppercase;letter-spacing:0.4px;font-weight:700;border-bottom:2px solid var(--border);}
.atable td{padding:11px 14px;border-bottom:1px solid var(--border);color:var(--text);}
.atable tr:hover td{background:#fafaf8;}
.atable .user-name{font-weight:600;color:var(--navy);}
.atable .user-email{font-size:11.5px;color:var(--text-light);}
.status-pill{display:inline-block;padding:3px 10px;border-radius:20px;font-size:10.5px;font-weight:600;}
.status-active{background:#e8f5e9;color:var(--green);}
.status-free{background:#f5f5f5;color:var(--text-light);}
.status-premium{background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(232,200,120,0.15));color:#8B6914;border:1px solid rgba(201,168,76,0.3);}
.score-chip{font-family:'DM Mono',monospace;font-size:12.5px;font-weight:600;}
.score-high{color:var(--green);}.score-mid{color:var(--orange);}.score-low{color:var(--red);}
.btn-admin-view{background:var(--navy);color:var(--white);border:none;padding:5px 12px;border-radius:5px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.15s;}
.btn-admin-view:hover{background:var(--navy-light);}
.btn-admin-upgrade{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);border:none;padding:5px 12px;border-radius:5px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600;}
.btn-admin-delete{background:#fff5f5;border:1px solid #ffcdd2;color:var(--red);padding:5px 10px;border-radius:5px;font-size:11px;cursor:pointer;}

/* ADMIN USER DETAIL MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(10,22,40,0.6);z-index:1000;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.show{display:flex;}
.modal-box{background:var(--white);border-radius:14px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);}
.modal-header{background:var(--navy);padding:20px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;}
.modal-header h3{color:var(--white);font-family:'Playfair Display',serif;font-size:17px;}
.modal-close{background:transparent;border:none;color:rgba(255,255,255,0.5);font-size:20px;cursor:pointer;padding:4px 8px;}
.modal-close:hover{color:var(--white);}
.modal-body{padding:24px;}
.modal-section{margin-bottom:20px;}
.modal-section h4{font-size:12px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);font-weight:700;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);}
.modal-kv-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.modal-kv{background:var(--section-bg);border-radius:7px;padding:10px 13px;}
.modal-kv .mk-label{font-size:10px;text-transform:uppercase;letter-spacing:0.3px;color:var(--text-light);font-weight:600;}
.modal-kv .mk-value{font-size:13.5px;color:var(--navy);font-weight:500;margin-top:3px;}

/* PLAN / MONETIZATION */
.pricing-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px;}
.pricing-card{background:var(--white);border:2px solid var(--border);border-radius:14px;padding:28px 24px;text-align:center;position:relative;transition:all 0.2s;}
.pricing-card.featured{border-color:var(--gold);box-shadow:var(--shadow-gold);}
.pricing-card .pc-badge{position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--gold);color:var(--navy);padding:3px 16px;border-radius:20px;font-size:10.5px;font-weight:700;letter-spacing:0.5px;white-space:nowrap;}
.pricing-card .pc-name{font-family:'Playfair Display',serif;font-size:20px;color:var(--navy);margin-bottom:6px;}
.pricing-card .pc-price{font-family:'DM Mono',monospace;font-size:32px;color:var(--gold);font-weight:700;margin:12px 0;}
.pricing-card .pc-price span{font-size:14px;color:var(--text-light);font-family:'DM Sans',sans-serif;}
.pricing-card ul{list-style:none;text-align:left;margin:16px 0 20px;}
.pricing-card ul li{padding:6px 0;font-size:13px;color:var(--text-mid);display:flex;align-items:center;gap:8px;}
.pricing-card ul li::before{content:'âœ“';color:var(--green);font-weight:700;font-size:12px;}
.pricing-card ul li.no::before{content:'âœ•';color:var(--text-light);}
.pricing-card ul li.no{color:var(--text-light);}
.pc-btn{width:100%;padding:11px;border-radius:8px;font-size:13.5px;font-weight:700;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;transition:all 0.2s;}
.pc-btn.primary{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);}
.pc-btn.outline{background:transparent;border:2px solid var(--gold);color:var(--gold);}
.pc-btn.plain{background:var(--section-bg);color:var(--text-mid);}
.pc-btn:hover{transform:translateY(-1px);}

/* REPORT */
#screen-report{background:var(--cream);}
.report-topbar{background:var(--white);border-bottom:1px solid var(--border);padding:12px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.report-topbar h2{font-family:'Playfair Display',serif;font-size:16px;color:var(--navy);}
.report-actions{display:flex;gap:12px;align-items:center;}
.report-body-wrap{max-width:1280px;margin:0 auto;padding:24px 28px;}

/* LOADING */
.loading-overlay{display:none;position:fixed;inset:0;background:rgba(10,22,40,0.75);z-index:9999;align-items:center;justify-content:center;flex-direction:column;gap:14px;}
.loading-overlay.show{display:flex;}
.spinner{width:44px;height:44px;border:3px solid rgba(201,168,76,0.3);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-overlay p{color:var(--gold-light);font-size:13.5px;}

/* REPORT STYLES */
.rpt-wrapper{background:var(--white);border-radius:14px;border:1px solid var(--border);overflow:hidden;box-shadow:var(--shadow);}
.rpt-header{background:linear-gradient(135deg,var(--navy) 0%,#1a2f5a 100%);padding:36px 44px;position:relative;overflow:hidden;}
.rpt-header::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;background:radial-gradient(circle,rgba(201,168,76,0.1) 0%,transparent 70%);border-radius:50%;}
.rpt-logo{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
.rpt-logo .ico{width:48px;height:48px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:12px;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--navy);}
.rpt-logo .lt h1{font-family:'Playfair Display',serif;color:var(--white);font-size:19px;}
.rpt-logo .lt p{color:var(--gold);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
.rpt-title{position:relative;z-index:1;}
.rpt-title h2{font-family:'Playfair Display',serif;color:var(--white);font-size:24px;margin-bottom:4px;}
.rpt-title p{color:rgba(255,255,255,0.5);font-size:13px;}
.rpt-meta{display:flex;gap:24px;margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);flex-wrap:wrap;}
.rpt-meta-item .ml{color:rgba(255,255,255,0.4);font-size:9.5px;text-transform:uppercase;letter-spacing:1px;}
.rpt-meta-item .mv{color:var(--gold-light);font-size:13px;font-weight:600;margin-top:2px;}
.rpt-body{padding:32px 44px;}
.rpt-section{margin-bottom:30px;}
.rpt-section-title{font-family:'Playfair Display',serif;font-size:16px;color:var(--navy);padding-bottom:10px;border-bottom:2px solid var(--border);margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.score-banner{background:linear-gradient(135deg,var(--navy),#1a2f5a);border-radius:12px;padding:24px 28px;display:flex;align-items:center;gap:24px;margin-bottom:28px;}
.score-circ{width:88px;height:88px;border-radius:50%;border:3px solid var(--gold);background:rgba(201,168,76,0.07);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;}
.score-circ .sn{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold);font-weight:700;line-height:1;}
.score-circ .sm{font-size:9.5px;color:rgba(255,255,255,0.35);}
.score-info h3{color:var(--white);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:3px;}
.score-info p{color:rgba(255,255,255,0.5);font-size:12px;}
.score-bars{flex:1;display:grid;grid-template-columns:repeat(3,1fr);gap:9px;}
.sbi .bl{font-size:9.5px;color:rgba(255,255,255,0.45);margin-bottom:3px;text-transform:uppercase;letter-spacing:0.4px;}
.sbi .bt{height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;}
.sbi .bf{height:100%;border-radius:3px;}
.bg{background:#4caf50;}.bw{background:#ff9800;}.bd{background:#f44336;}
.sbi .bv{font-size:10.5px;color:rgba(255,255,255,0.65);margin-top:2px;font-weight:600;}
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:18px;}
.kpi-c{background:var(--section-bg);border-radius:9px;padding:13px 16px;border:1px solid var(--border);}
.kpi-c .kl{font-size:9.5px;text-transform:uppercase;letter-spacing:0.4px;color:var(--text-light);font-weight:600;}
.kpi-c .kv{font-family:'DM Mono',monospace;font-size:17px;color:var(--navy);font-weight:500;margin:4px 0 3px;}
.kpi-c .ks{font-size:10px;color:var(--text-light);}
.kpi-c.cgold{border-left:3px solid var(--gold);}.kpi-c.cgreen{border-left:3px solid #4caf50;}.kpi-c.cred{border-left:3px solid var(--red);}.kpi-c.cblue{border-left:3px solid #2196f3;}
.rpt-table{width:100%;border-collapse:collapse;font-size:12px;}
.rpt-table th{background:var(--navy);color:var(--white);padding:8px 12px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:0.4px;}
.rpt-table td{padding:8px 12px;border-bottom:1px solid var(--border);vertical-align:top;}
.rpt-table tr:hover td{background:#fafaf8;}
.sok{color:var(--green);font-weight:600;}.swarn{color:var(--orange);font-weight:600;}.sbad{color:var(--red);font-weight:600;}
.sug-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
.sug-card{border-radius:9px;padding:14px 16px;border:1px solid;}
.sug-card.sh{border-color:#ffcdd2;background:#fff5f5;}
.sug-card.sm{border-color:#ffe0b2;background:#fff8f0;}
.sug-card.sl{border-color:#c8e6c9;background:#f1f8f1;}
.sug-card.si{border-color:#b3d9f5;background:#e8f4fd;}
.sug-badge{display:inline-block;padding:2px 8px;border-radius:20px;font-size:9px;font-weight:700;letter-spacing:0.8px;text-transform:uppercase;margin-bottom:6px;}
.sh .sug-badge{background:#ffcdd2;color:var(--red);}.sm .sug-badge{background:#ffe0b2;color:var(--orange);}.sl .sug-badge{background:#c8e6c9;color:var(--green);}.si .sug-badge{background:#b3d9f5;color:#1565c0;}
.sug-card h4{font-size:13px;color:var(--navy);margin-bottom:4px;font-weight:600;}
.sug-card p{font-size:11.5px;color:var(--text-mid);line-height:1.6;}
.ins-rec-card{background:var(--section-bg);border:1px solid var(--border);border-radius:9px;padding:14px 16px;margin-bottom:10px;}
.ins-rec-card h4{font-size:12.5px;font-weight:700;color:var(--navy);margin-bottom:3px;}
.ins-rec-card p{font-size:11.5px;color:var(--text-mid);line-height:1.6;}
.ppills{display:flex;flex-wrap:wrap;gap:7px;margin-top:8px;}
.ppill{background:var(--navy);color:var(--gold-light);padding:3px 11px;border-radius:20px;font-size:10.5px;font-weight:600;}
.sebi-disc{background:#fff3e0;border:2px solid #ffcc80;border-radius:9px;padding:12px 16px;margin-bottom:18px;font-size:11.5px;color:#b71c1c;font-weight:500;line-height:1.6;}
.port-badge{display:inline-block;padding:3px 9px;border-radius:20px;font-size:9.5px;font-weight:700;}
.pbuy{background:#e8f5e9;color:var(--green);}.phold{background:#e3f2fd;color:#1565c0;}.psell{background:#fff5f5;color:var(--red);}.prev{background:#fff3e0;color:var(--orange);}
.disc-box{background:var(--section-bg);border:1px solid var(--border);border-radius:9px;padding:16px 20px;margin-top:24px;font-size:11px;color:var(--text-light);line-height:1.75;}
.disc-box strong{color:var(--text-mid);}
.goal-proj-row{display:grid;grid-template-columns:1.8fr 0.7fr 1.1fr 1.2fr 1.2fr;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px;}
.edu-rpt-table{width:100%;border-collapse:collapse;font-size:11.5px;}
.edu-rpt-table th{background:linear-gradient(135deg,var(--navy-mid),var(--navy));color:var(--white);padding:8px 11px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:0.4px;}
.edu-rpt-table td{padding:7px 11px;border-bottom:1px solid var(--border);}

/* PRINT */
@media print{
  .report-topbar,.no-print,.admin-sidebar,.admin-topbar{display:none!important;}
  body{background:white;}
  .rpt-wrapper{box-shadow:none;border:none;}
  .rpt-header,.score-banner{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  .rpt-table th{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  .rpt-section{page-break-inside:avoid;}
  .rpt-body{padding:20px;}
}
@media(max-width:1024px){
  .admin-sidebar{display:none;}
  .admin-main{margin-left:0;}
}
@media(max-width:768px){
  .dash-grid,.dash-actions,.admin-stats,.pricing-grid{grid-template-columns:1fr;}
  .app-body,.rpt-body{padding:16px;}
  .form-grid,.form-grid-2,.form-grid-4{grid-template-columns:1fr;}
  .kpi-row{grid-template-columns:repeat(2,1fr);}
  .sug-grid{grid-template-columns:1fr;}
  .score-banner{flex-direction:column;}
  .score-bars{grid-template-columns:repeat(2,1fr);}
  .rpt-header,.rpt-body{padding:20px;}
  .modal-kv-grid{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>
<body>

<!-- LOADING -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <p id="loadingMsg">Processingâ€¦</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: LANDING / AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="screen-landing">
  <div class="landing-hero">
    <div class="landing-card">
      <div class="landing-logo">
        <div class="badge">SF</div>
        <h1>Sekhar Financial Services</h1>
        <p>Your Trusted Financial Planning Partner</p>
      </div>
      <div class="landing-tabs">
        <div class="landing-tab active" onclick="switchTab('login')">Sign In</div>
        <div class="landing-tab" onclick="switchTab('register')">Register</div>
      </div>

      <!-- LOGIN -->
      <div class="tab-panel active" id="tab-login">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="login-email" placeholder="yourname@email.com">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
        </div>
        <button class="auth-btn" onclick="doLogin()">Sign In to My Account â†’</button>
        <div class="auth-msg" id="login-msg"></div>
      </div>

      <!-- REGISTER -->
      <div class="tab-panel" id="tab-register">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="reg-name" placeholder="Your full name">
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="reg-email" placeholder="yourname@email.com">
        </div>
        <div class="form-group">
          <label>Mobile Number</label>
          <input type="tel" id="reg-mobile" placeholder="+91 98765 43210">
        </div>
        <div class="form-group">
          <label>Password (min 8 characters)</label>
          <input type="password" id="reg-pass" placeholder="Create a strong password">
        </div>
        <div class="form-group">
          <label>Referral Code (optional)</label>
          <input type="text" id="reg-ref" placeholder="e.g. SFS2024">
        </div>
        <button class="auth-btn" onclick="doRegister()">Create My Account â†’</button>
        <div class="auth-msg" id="reg-msg"></div>
      </div>

      <div class="privacy-note">
        ğŸ”’ <strong>Your data is private & protected.</strong><br>
        Your personal and financial information is encrypted, stored securely, and will never be shared with any third party. Only you can access your data. By registering, you agree to our Privacy Policy.
      </div>
    </div>
  </div>
  <div class="landing-footer">
    Â© 2024 Sekhar Financial Services Â· All rights reserved Â· Not a SEBI Registered Adviser
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: USER DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-dashboard">
  <div class="dash-header">
    <div class="dash-header-inner">
      <div class="logo-block">
        <div class="logo-icon">SF</div>
        <div class="logo-text"><h1>Sekhar Financial Services</h1><p>Personal Finance Platform</p></div>
      </div>
      <div class="header-right">
        <div class="user-pill"><div class="dot"></div><span id="dash-username">User</span></div>
        <span class="plan-badge plan-free" id="dash-plan-badge">FREE</span>
        <button class="btn-logout" onclick="doLogout()">Sign Out</button>
      </div>
    </div>
  </div>
  <div class="dash-body">
    <div class="privacy-banner">
      <div class="pb-icon">ğŸ”</div>
      <div>
        <h3>Your Data is Private & Secure</h3>
        <p>Your financial information is stored securely under your account only. No advisor, third party, or other user can see your data. Sekhar Financial Services staff may access data solely to provide you with better service. We will never sell or share your information. You may request deletion of your data at any time.</p>
      </div>
    </div>
    <div class="dash-welcome">
      <h2>Welcome back, <span id="dash-name">User</span> ğŸ‘‹</h2>
      <p>Your personalised financial planning portal â€” pick up where you left off or start a new assessment.</p>
    </div>
    <div class="dash-grid" id="dash-summary-cards">
      <div class="dash-card gold"><div class="dc-label">Financial Health Score</div><div class="dc-value" id="d_score">â€”</div><div class="dc-sub">Last assessment</div></div>
      <div class="dash-card green"><div class="dc-label">Monthly Surplus</div><div class="dc-value" id="d_surplus">â€”</div><div class="dc-sub">After expenses & EMIs</div></div>
      <div class="dash-card blue"><div class="dc-label">Total Corpus</div><div class="dc-value" id="d_corpus">â€”</div><div class="dc-sub">All investments combined</div></div>
      <div class="dash-card red"><div class="dc-label">Insurance Status</div><div class="dc-value" id="d_ins">â€”</div><div class="dc-sub">Life + Health coverage</div></div>
      <div class="dash-card gold"><div class="dc-label">Emergency Fund</div><div class="dc-value" id="d_emg">â€”</div><div class="dc-sub">Months of coverage</div></div>
      <div class="dash-card green"><div class="dc-label">Plan Type</div><div class="dc-value" id="d_plan">Free</div><div class="dc-sub">Upgrade for premium features</div></div>
    </div>
    <div class="dash-actions">
      <button class="dash-action-btn" onclick="startApp()">
        <div class="icon gold">ğŸ“‹</div>
        <div><h3>Start / Continue Financial Assessment</h3><p>Fill or update your complete financial profile â€” all 11 sections</p></div>
      </button>
      <button class="dash-action-btn" onclick="viewReport()">
        <div class="icon blue">ğŸ“Š</div>
        <div><h3>View My Latest Report</h3><p>See your personalised financial analysis and recommendations</p></div>
      </button>
      <button class="dash-action-btn" onclick="showPricing()">
        <div class="icon gold">â­</div>
        <div><h3>Upgrade to Premium</h3><p>Unlock portfolio tracking, goal alerts, advisor chat & more</p></div>
      </button>
      <button class="dash-action-btn" onclick="showScreen('screen-privacy')">
        <div class="icon green">ğŸ”’</div>
        <div><h3>Privacy Policy & Data Rights</h3><p>Learn how your data is stored, protected, and your rights</p></div>
      </button>
    </div>
    <div class="report-history">
      <div class="rh-header"><h3>Assessment History</h3><span style="font-size:12px;color:var(--text-light)" id="rh-count">No assessments yet</span></div>
      <div id="rh-list"><div style="padding:24px;text-align:center;color:var(--text-light);font-size:13px">Start your first financial assessment to see your history here.</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: MAIN APP (FORM)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-app">
  <div class="app-header">
    <div class="header-inner">
      <div class="logo-block">
        <div class="logo-icon">SF</div>
        <div class="logo-text"><h1>Sekhar Financial Services</h1><p>Financial Assessment</p></div>
      </div>
      <div class="header-right">
        <div class="save-indicator"><div class="save-dot" id="saveDot"></div><span id="saveStatus">All changes saved</span></div>
        <div class="user-pill"><div class="dot"></div><span id="app-username">User</span></div>
        <button class="btn-logout" onclick="showScreen('screen-dashboard')">â† Dashboard</button>
        <button class="btn-logout" onclick="doLogout()">Sign Out</button>
      </div>
    </div>
  </div>
  <nav class="progress-nav">
    <div class="progress-nav-inner" id="navBar"></div>
  </nav>
  <main class="app-body">
    <div id="sectionsContainer"></div>
  </main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-report">
  <div class="report-topbar no-print">
    <div style="display:flex;align-items:center;gap:12px">
      <button class="btn-outline btn" onclick="showScreen('screen-dashboard')">â† Dashboard</button>
      <h2>Financial Report â€” <span id="rpt-client-name"></span></h2>
    </div>
    <div class="report-actions">
      <button class="btn btn-outline" onclick="startApp()">âœï¸ Edit Data</button>
      <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ Save as PDF</button>
    </div>
  </div>
  <div class="report-body-wrap">
    <div class="rpt-wrapper" id="reportContent"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: SUBSCRIPTION / PRICING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-pricing">
  <div class="app-header">
    <div class="header-inner">
      <div class="logo-block"><div class="logo-icon">SF</div><div class="logo-text"><h1>Sekhar Financial Services</h1><p>Subscription Plans</p></div></div>
      <div class="header-right"><button class="btn-logout" onclick="showScreen('screen-dashboard')">â† Back to Dashboard</button></div>
    </div>
  </div>
  <div style="max-width:1060px;margin:40px auto;padding:0 28px">

    <!-- Current Plan Banner -->
    <div id="current-plan-banner" style="background:linear-gradient(135deg,var(--navy),#1a3460);border-radius:12px;padding:18px 24px;margin-bottom:32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px">
      <div>
        <div style="color:rgba(255,255,255,.45);font-size:10.5px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Your Current Plan</div>
        <div style="color:var(--white);font-size:18px;font-weight:700;font-family:'Playfair Display',serif" id="cp-name">Basic (Free)</div>
        <div style="color:rgba(255,255,255,.4);font-size:12px;margin-top:3px" id="cp-status">Upgrade anytime â€” your data is always preserved</div>
      </div>
      <div id="cp-expiry" style="text-align:right;color:var(--gold-light);font-size:13px"></div>
    </div>

    <div style="text-align:center;margin-bottom:32px">
      <h2 style="font-family:'Playfair Display',serif;font-size:30px;color:var(--navy)">Choose Your Subscription</h2>
      <p style="color:var(--text-light);font-size:13.5px;margin-top:6px">Simple, transparent pricing. No hidden charges.</p>
    </div>

    <div class="pricing-grid">
      <!-- BASIC -->
      <div class="pricing-card" id="pc-basic">
        <div class="pc-name">Basic</div>
        <div class="pc-price">Free<span>/forever</span></div>
        <ul>
          <li>1 Financial Assessment</li>
          <li>Basic Financial Report</li>
          <li>Insurance Analysis</li>
          <li>Goal Projections</li>
          <li class="no">Portfolio Review (MF/ETF/Stocks)</li>
          <li class="no">Child Education Planner</li>
          <li class="no">1-on-1 Advisor Session</li>
          <li class="no">PDF Report Downloads</li>
          <li class="no">Assessment History</li>
        </ul>
        <button class="pc-btn plain" id="pc-basic-btn" onclick="selectPlan('basic')">Select Basic</button>
      </div>

      <!-- PROFESSIONAL -->
      <div class="pricing-card featured" id="pc-professional">
        <div class="pc-badge">â­ MOST POPULAR</div>
        <div class="pc-name">Professional</div>
        <div class="pc-price">â‚¹999<span>/year</span></div>
        <div style="font-size:11px;color:var(--text-light);margin:-8px 0 12px;text-align:center">â‰ˆ â‚¹83/month Â· GST extra</div>
        <ul>
          <li>Unlimited Assessments</li>
          <li>Full Comprehensive Report</li>
          <li>Insurance Analysis + Product Picks</li>
          <li>Goal Projections + Education Planner</li>
          <li>Portfolio Review (MF / ETF / Stocks)</li>
          <li>Unlimited PDF Downloads</li>
          <li>Annual Review Reminders</li>
          <li>Priority Email Support</li>
          <li class="no">1-on-1 Advisor Consultation</li>
        </ul>
        <button class="pc-btn primary" id="pc-professional-btn" onclick="selectPlan('professional')">Subscribe â†’ â‚¹999/yr</button>
      </div>

      <!-- ELITE -->
      <div class="pricing-card" id="pc-elite">
        <div class="pc-name">Elite</div>
        <div class="pc-price">â‚¹2,999<span>/year</span></div>
        <div style="font-size:11px;color:var(--text-light);margin:-8px 0 12px;text-align:center">â‰ˆ â‚¹250/month Â· GST extra</div>
        <ul>
          <li>Everything in Professional</li>
          <li>2 Ã— 1-on-1 Advisor Sessions/year</li>
          <li>Tax Planning Guidance</li>
          <li>Investment Tracking Dashboard</li>
          <li>WhatsApp Goal Milestone Alerts</li>
          <li>Family Planning (Spouse + Children)</li>
          <li>Dedicated Support Executive</li>
          <li>Priority Processing</li>
          <li>Early Access to New Features</li>
        </ul>
        <button class="pc-btn outline" id="pc-elite-btn" onclick="selectPlan('elite')">Subscribe â†’ â‚¹2,999/yr</button>
      </div>
    </div>

    <!-- HOW TO SUBSCRIBE -->
    <div style="background:var(--white);border:1px solid var(--border);border-radius:14px;padding:28px;margin-top:28px;box-shadow:var(--shadow)">
      <h3 style="font-family:'Playfair Display',serif;font-size:17px;color:var(--navy);margin-bottom:18px;text-align:center">ğŸ“‹ How to Subscribe</h3>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px">
        <div style="text-align:center;padding:16px 12px;background:var(--section-bg);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:26px;margin-bottom:8px">1ï¸âƒ£</div>
          <div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Choose Plan</div>
          <div style="font-size:11.5px;color:var(--text-light)">Click Subscribe on your preferred plan above</div>
        </div>
        <div style="text-align:center;padding:16px 12px;background:var(--section-bg);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:26px;margin-bottom:8px">2ï¸âƒ£</div>
          <div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Contact Us</div>
          <div style="font-size:11.5px;color:var(--text-light)">WhatsApp or email us â€” we'll send payment details</div>
        </div>
        <div style="text-align:center;padding:16px 12px;background:var(--section-bg);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:26px;margin-bottom:8px">3ï¸âƒ£</div>
          <div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Pay Securely</div>
          <div style="font-size:11.5px;color:var(--text-light)">UPI / Bank Transfer / Cheque â€” receipt provided</div>
        </div>
        <div style="text-align:center;padding:16px 12px;background:var(--section-bg);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:26px;margin-bottom:8px">4ï¸âƒ£</div>
          <div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Plan Activated</div>
          <div style="font-size:11.5px;color:var(--text-light)">Account upgraded within 2 hours of payment</div>
        </div>
      </div>

      <!-- Contact Card -->
      <div style="background:linear-gradient(135deg,var(--navy),#1a3460);border-radius:10px;padding:20px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px">
        <div>
          <div style="color:var(--gold-light);font-weight:700;font-size:15px;margin-bottom:4px">Ready to subscribe?</div>
          <div style="color:rgba(255,255,255,.5);font-size:12.5px">Contact us and we'll set up your premium account</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a href="https://wa.me/919XXXXXXXXX?text=Hi, I want to subscribe to Sekhar Financial Services Professional plan." target="_blank"
             style="background:#25d366;color:white;padding:10px 18px;border-radius:8px;font-size:13px;font-weight:700;text-decoration:none;display:flex;align-items:center;gap:6px">
            ğŸ“± WhatsApp Us
          </a>
          <a href="/cdn-cgi/l/email-protection#0a797f68796978637a7e636564794a796f61626b786c63646b6469636b662469656735797f68606f697e37597f68796978637a7e6365642a4f647b7f637873" style="background:var(--gold);color:var(--navy);padding:10px 18px;border-radius:8px;font-size:13px;font-weight:700;text-decoration:none;display:flex;align-items:center;gap:6px">
            âœ‰ï¸ Email Us
          </a>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div style="margin-top:24px;background:var(--white);border:1px solid var(--border);border-radius:14px;padding:26px;box-shadow:var(--shadow)">
      <h3 style="font-family:'Playfair Display',serif;font-size:17px;color:var(--navy);margin-bottom:18px">â“ Frequently Asked Questions</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Can I cancel anytime?</div><div style="font-size:12.5px;color:var(--text-mid)">Yes. Cancel before your renewal date and you won't be charged again. Your data stays accessible till expiry.</div></div>
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">What happens to my data if I downgrade?</div><div style="font-size:12.5px;color:var(--text-mid)">All your data is safely preserved. You just lose access to premium features, not your information.</div></div>
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Is a receipt/invoice provided?</div><div style="font-size:12.5px;color:var(--text-mid)">Yes â€” a GST-compliant invoice is issued for every payment via email within 24 hours.</div></div>
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Can I upgrade mid-year?</div><div style="font-size:12.5px;color:var(--text-mid)">Yes. We'll pro-rate the remaining period and credit it toward your new plan.</div></div>
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">Are GST and taxes extra?</div><div style="font-size:12.5px;color:var(--text-mid)">GST @ 18% is applicable and charged on top of the plan price. Included in your invoice.</div></div>
        <div><div style="font-weight:700;color:var(--navy);font-size:13px;margin-bottom:4px">What payment methods do you accept?</div><div style="font-size:12.5px;color:var(--text-mid)">UPI, bank transfer (NEFT/RTGS/IMPS), cheque. We confirm receipt before activating.</div></div>
      </div>
    </div>
  </div>
</div>

<!-- SUBSCRIPTION REQUEST MODAL -->
<div class="modal-overlay" id="subscribeModal" style="display:none;position:fixed;inset:0;background:rgba(10,22,40,.65);z-index:1000;align-items:center;justify-content:center;padding:20px">
  <div style="background:var(--white);border-radius:16px;max-width:480px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden">
    <div style="background:var(--navy);padding:18px 22px;display:flex;align-items:center;justify-content:space-between">
      <h3 style="color:var(--white);font-family:'Playfair Display',serif;font-size:16px" id="sub-modal-title">Subscribe to Professional</h3>
      <button onclick="closeSubModal()" style="background:transparent;border:none;color:rgba(255,255,255,.45);font-size:20px;cursor:pointer">âœ•</button>
    </div>
    <div style="padding:24px">
      <!-- Plan Summary -->
      <div id="sub-plan-summary" style="background:var(--section-bg);border-radius:10px;padding:14px 18px;margin-bottom:20px;border-left:4px solid var(--gold)"></div>

      <!-- Request Form -->
      <div style="margin-bottom:14px">
        <label style="font-size:10.5px;font-weight:700;color:var(--text-mid);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:5px">Your Name</label>
        <input type="text" id="sub-name" style="width:100%;padding:10px 13px;border:1.5px solid var(--border);border-radius:7px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none" readonly>
      </div>
      <div style="margin-bottom:14px">
        <label style="font-size:10.5px;font-weight:700;color:var(--text-mid);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:5px">Email Address</label>
        <input type="email" id="sub-email" style="width:100%;padding:10px 13px;border:1.5px solid var(--border);border-radius:7px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none" readonly>
      </div>
      <div style="margin-bottom:14px">
        <label style="font-size:10.5px;font-weight:700;color:var(--text-mid);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:5px">Mobile (for WhatsApp confirmation)</label>
        <input type="tel" id="sub-mobile" placeholder="+91 98765 43210" style="width:100%;padding:10px 13px;border:1.5px solid var(--border);border-radius:7px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none">
      </div>
      <div style="margin-bottom:18px">
        <label style="font-size:10.5px;font-weight:700;color:var(--text-mid);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:5px">Message (optional)</label>
        <textarea id="sub-msg" rows="2" placeholder="Any questions or special requirementsâ€¦" style="width:100%;padding:10px 13px;border:1.5px solid var(--border);border-radius:7px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none;resize:vertical"></textarea>
      </div>
      <button onclick="submitSubscription()" style="width:100%;padding:13px;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);font-weight:700;font-size:14px;border:none;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif">
        Send Subscription Request â†’
      </button>
      <p style="font-size:11.5px;color:var(--text-light);text-align:center;margin-top:10px">We'll contact you within 2 hours with payment details</p>
      <div id="sub-success" style="display:none;background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:14px;text-align:center;margin-top:14px">
        <div style="font-size:24px;margin-bottom:6px">âœ…</div>
        <div style="font-weight:700;color:var(--green);font-size:13.5px">Request Sent Successfully!</div>
        <div style="font-size:12px;color:var(--text-mid);margin-top:4px">We'll WhatsApp / email you within 2 hours.</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: PRIVACY POLICY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-privacy">
  <div class="app-header">
    <div class="header-inner">
      <div class="logo-block"><div class="logo-icon">SF</div><div class="logo-text"><h1>Sekhar Financial Services</h1></div></div>
      <div class="header-right"><button class="btn-logout" onclick="showScreen('screen-dashboard')">â† Back</button></div>
    </div>
  </div>
  <div style="max-width:800px;margin:36px auto;padding:0 28px">
    <div style="background:var(--white);border-radius:14px;border:1px solid var(--border);padding:40px;box-shadow:var(--shadow)">
      <div style="text-align:center;margin-bottom:32px">
        <div style="font-size:40px;margin-bottom:12px">ğŸ”’</div>
        <h2 style="font-family:'Playfair Display',serif;font-size:26px;color:var(--navy)">Privacy Policy & Data Protection</h2>
        <p style="color:var(--text-light);font-size:13px;margin-top:6px">Effective Date: January 1, 2024 Â· Last Updated: January 1, 2024</p>
      </div>
      <div style="font-size:13.5px;color:var(--text-mid);line-height:1.9">
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">1. Your Data Belongs to You</h3>
        <p style="margin-bottom:16px">All personal and financial information you provide on this platform belongs exclusively to you. Sekhar Financial Services acts only as a trusted custodian of your data to provide you with financial planning services.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">2. What We Collect</h3>
        <p style="margin-bottom:16px">We collect your name, email, mobile number, and the financial data you voluntarily enter (income, expenses, investments, insurance, loans, and goals). We do not collect bank account credentials, PAN, Aadhaar, or payment card details through this form.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">3. How We Use Your Data</h3>
        <p style="margin-bottom:16px">Your data is used solely to: (a) generate your personalised financial planning report, (b) save your progress so you can resume assessments, and (c) allow you to view your report history. We do not use your data for marketing without consent.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">4. Data Confidentiality</h3>
        <p style="margin-bottom:16px">Your financial data is visible only to you when logged in. No other registered user can see your data. Sekhar Financial Services administrators may access data solely for platform support and quality purposes, subject to strict confidentiality obligations.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">5. No Third-Party Sharing</h3>
        <p style="margin-bottom:16px">We do not sell, rent, trade, or share your personal or financial data with any third party, advertiser, or financial institution without your explicit written consent. Insurance product names mentioned in reports are for general reference only â€” we receive no commission for their mention.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">6. Data Security</h3>
        <p style="margin-bottom:16px">Your data is stored with industry-standard encryption. We recommend using a strong, unique password and logging out after each session. Do not share your login credentials with anyone.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">7. Your Rights</h3>
        <p style="margin-bottom:16px">You have the right to: (a) access all data stored about you, (b) request correction of incorrect data, (c) request permanent deletion of your account and all associated data, and (d) download a copy of your data. To exercise any of these rights, email us at <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0b7b79627d6a68724b786e60636a796d62656a6568626a6725686466">[email&#160;protected]</a></strong>.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">8. Not SEBI Registered</h3>
        <p style="margin-bottom:16px">Sekhar Financial Services is <strong>NOT a SEBI Registered Investment Adviser</strong>. All content on this platform is for educational and general awareness purposes only and does not constitute regulated financial or investment advice.</p>
        <h3 style="color:var(--navy);font-family:'Playfair Display',serif;font-size:17px;margin-bottom:8px">9. Contact Us</h3>
        <p>For any privacy concerns or data requests, contact us at: <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ceceef5eafdffe5dceff9f7f4fdeefaf5f2fdf2fff5fdf0b2fff3f1">[email&#160;protected]</a></strong> or call <strong>+91 XXXXX XXXXX</strong>.</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: ADMIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-admin">
  <div class="admin-sidebar">
    <div class="admin-logo">
      <div class="badge">SF</div>
      <h1>Admin Panel</h1>
      <p>Sekhar Financial Services</p>
    </div>
    <nav class="admin-nav">
      <div class="admin-nav-item active" onclick="adminNav('overview')"><span class="nav-icon">ğŸ“Š</span> Overview</div>
      <div class="admin-nav-item" onclick="adminNav('users')"><span class="nav-icon">ğŸ‘¥</span> All Users</div>
      <div class="admin-nav-item" onclick="adminNav('reports')"><span class="nav-icon">ğŸ“‹</span> Reports</div>
      <div class="admin-nav-item" onclick="adminNav('revenue')"><span class="nav-icon">ğŸ’°</span> Revenue</div>
      <div class="admin-nav-item" onclick="adminNav('payments')"><span class="nav-icon">ğŸ’³</span> Payments</div>
      <div class="admin-nav-item" onclick="adminNav('settings')"><span class="nav-icon">âš™ï¸</span> Setup Guide</div>
    </nav>
    <div class="admin-footer">
      <button class="btn-logout" onclick="doLogout()" style="width:100%">â† Sign Out</button>
    </div>
  </div>
  <div class="admin-main">
    <div class="admin-topbar">
      <h2 id="admin-page-title">Overview</h2>
      <div class="admin-topbar-right">
        <span class="admin-badge">ğŸ”‘ ADMIN</span>
        <span style="font-size:12px;color:var(--text-light)" id="admin-username-display">Admin</span>
      </div>
    </div>
    <div class="admin-content">

      <!-- OVERVIEW -->
      <div class="admin-panel active" id="panel-overview">
        <div class="admin-stats" id="admin-stats-grid"></div>
        <div class="admin-table-wrap">
          <div class="admin-table-header">
            <h3>Recent Registrations</h3>
            <span style="font-size:12px;color:var(--text-light)" id="recent-reg-count"></span>
          </div>
          <div style="overflow-x:auto">
            <table class="atable"><thead><tr><th>Name</th><th>Email</th><th>Registered</th><th>Plan</th><th>Score</th><th>Actions</th></tr></thead>
            <tbody id="recent-users-tbody"></tbody></table>
          </div>
        </div>
      </div>

      <!-- USERS -->
      <div class="admin-panel" id="panel-users">
        <div class="admin-table-wrap">
          <div class="admin-table-header">
            <h3>All Registered Users</h3>
            <input class="admin-search" type="text" placeholder="ğŸ” Search usersâ€¦" oninput="filterUsers(this.value)">
          </div>
          <div style="overflow-x:auto">
            <table class="atable"><thead><tr><th>Name</th><th>Email</th><th>Mobile</th><th>Registered</th><th>Last Login</th><th>Plan</th><th>Score</th><th>Assessments</th><th>Actions</th></tr></thead>
            <tbody id="all-users-tbody"></tbody></table>
          </div>
        </div>
      </div>

      <!-- REPORTS -->
      <div class="admin-panel" id="panel-reports">
        <div class="admin-table-wrap">
          <div class="admin-table-header"><h3>All Financial Reports</h3></div>
          <div style="overflow-x:auto">
            <table class="atable"><thead><tr><th>Client</th><th>Date</th><th>Score</th><th>Surplus</th><th>Corpus</th><th>Life Cover</th><th>Health Cover</th><th>Plan</th><th>Actions</th></tr></thead>
            <tbody id="all-reports-tbody"></tbody></table>
          </div>
        </div>
      </div>

      <!-- REVENUE -->
      <div class="admin-panel" id="panel-revenue">
        <div class="admin-stats">
          <div class="stat-card"><div class="sc-icon">ğŸ’°</div><div class="sc-label">Total Revenue (MRR)</div><div class="sc-value" id="rev-mrr">â‚¹0</div><div class="sc-change">Monthly recurring</div></div>
          <div class="stat-card"><div class="sc-icon">â­</div><div class="sc-label">Premium Users</div><div class="sc-value" id="rev-premium">0</div><div class="sc-change">Active subscriptions</div></div>
          <div class="stat-card"><div class="sc-icon">ğŸ“ˆ</div><div class="sc-label">Conversion Rate</div><div class="sc-value" id="rev-conv">0%</div><div class="sc-change">Free â†’ Paid</div></div>
          <div class="stat-card"><div class="sc-icon">ğŸ””</div><div class="sc-label">Pending Requests</div><div class="sc-value" id="rev-pending">0</div><div class="sc-change">Awaiting activation</div></div>
        </div>

        <!-- PENDING SUBSCRIPTION REQUESTS -->
        <div class="admin-table-wrap" style="margin-bottom:20px">
          <div class="admin-table-header">
            <h3>ğŸ”” Pending Subscription Requests</h3>
            <span style="font-size:12px;color:var(--text-light)">Activate after confirming payment receipt</span>
          </div>
          <div style="overflow-x:auto">
            <table class="atable"><thead><tr><th>Name</th><th>Email</th><th>Plan Requested</th><th>Mobile</th><th>Requested On</th><th>Message</th><th>Action</th></tr></thead>
            <tbody id="pending-requests-tbody"></tbody></table>
          </div>
        </div>

        <!-- ACTIVE SUBSCRIBERS -->
        <div class="admin-table-wrap">
          <div class="admin-table-header"><h3>âœ… Active Premium Subscribers</h3></div>
          <div style="overflow-x:auto">
            <table class="atable"><thead><tr><th>Name</th><th>Email</th><th>Plan</th><th>Started</th><th>Expires</th><th>Amount</th><th>Status</th></tr></thead>
            <tbody id="revenue-tbody"></tbody></table>
          </div>
        </div>
      </div>


      <!-- PAYMENTS (Report fees) -->
      <div class="admin-panel" id="panel-payments">
        <div class="admin-stats" style="grid-template-columns:repeat(4,1fr)">
          <div class="stat-card"><div class="sc-icon">ğŸ’°</div><div class="sc-label">Total Collected</div><div class="sc-value" id="pay-total">â‚¹0</div><div class="sc-change">Report fees</div></div>
          <div class="stat-card"><div class="sc-icon">ğŸ“‹</div><div class="sc-label">Transactions</div><div class="sc-value" id="pay-count">0</div><div class="sc-change">All time</div></div>
          <div class="stat-card"><div class="sc-icon">â³</div><div class="sc-label">Pending Verify</div><div class="sc-value" id="pay-pending">0</div><div class="sc-change">Needs reconciliation</div></div>
          <div class="stat-card"><div class="sc-icon">âœ…</div><div class="sc-label">Verified</div><div class="sc-value" id="pay-verified">0</div><div class="sc-change">Confirmed</div></div>
        </div>
        <div class="admin-table-wrap">
          <div class="admin-table-header">
            <h3>ğŸ’³ Report Payment Transactions (â‚¹199/report)</h3>
            <button onclick="exportPaymentsCSV()" style="background:var(--green);color:#fff;border:none;padding:7px 16px;border-radius:6px;font-size:12.5px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600">ğŸ“¥ Export CSV</button>
          </div>
          <div style="overflow-x:auto">
            <table class="atable">
              <thead><tr><th>Name</th><th>Email</th><th>Mobile</th><th>Amount</th><th>UTR / Txn ID</th><th>UPI ID Paid To</th><th>Date & Time</th><th>Status</th><th>Action</th></tr></thead>
              <tbody id="payments-tbody"><tr><td colspan="9" style="padding:20px;text-align:center;color:var(--text-light)">No payment records yet.</td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SETTINGS â€” Setup Guide with Apps Script -->
      <div class="admin-panel" id="panel-settings">
        <!-- Config status cards -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:20px">
          <div class="admin-table-wrap" style="padding:20px">
            <h3 style="font-family:'Playfair Display',serif;font-size:15px;margin-bottom:14px">âš™ï¸ Current Configuration</h3>
            <div style="display:flex;flex-direction:column;gap:10px;font-size:13px">
              <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 12px;background:var(--section-bg);border-radius:7px">
                <span style="color:var(--text-mid)">UPI ID</span>
                <strong id="cfg-upi" style="font-family:'DM Mono',monospace;color:var(--navy)">â€”</strong>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 12px;background:var(--section-bg);border-radius:7px">
                <span style="color:var(--text-mid)">UPI Name</span>
                <strong id="cfg-upi-name" style="color:var(--navy)">â€”</strong>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 12px;background:var(--section-bg);border-radius:7px">
                <span style="color:var(--text-mid)">Report Price</span>
                <strong id="cfg-price" style="color:var(--green);font-family:'DM Mono',monospace">â‚¹199</strong>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 12px;background:var(--section-bg);border-radius:7px">
                <span style="color:var(--text-mid)">Google Sheets</span>
                <strong id="cfg-sheets-status" style="font-size:12px">â€”</strong>
              </div>
            </div>
            <div id="cfg-warning" style="margin-top:12px;background:#fff3e0;border:1px solid #ffcc80;border-radius:7px;padding:10px 12px;font-size:11.5px;color:var(--orange);display:none">
              âš ï¸ Sheets webhook not configured. Edit APP_CONFIG in the HTML source to enable auto-backup.
            </div>
          </div>
          <div class="admin-table-wrap" style="padding:20px">
            <h3 style="font-family:'Playfair Display',serif;font-size:15px;margin-bottom:14px">ğŸ“Š What Gets Saved to Sheets</h3>
            <div style="font-size:12.5px;color:var(--text-mid);line-height:2">
              âœ… <strong>Registrations</strong> â€” Name, Email, Mobile, Password hint, Date<br>
              âœ… <strong>Logins</strong> â€” Email, Timestamp, Last login<br>
              âœ… <strong>Assessments</strong> â€” All 40+ financial fields<br>
              âœ… <strong>Report Payments</strong> â€” UTR, Amount, UPI, Status<br>
              âœ… <strong>Subscription Requests</strong> â€” Plan, Mobile, Message<br><br>
              Each event goes to its own named tab in Google Sheets. Data appears within seconds of user action.
            </div>
          </div>
        </div>

        <!-- Step by step guide -->
        <div class="admin-table-wrap" style="padding:22px;margin-bottom:18px">
          <h3 style="font-family:'Playfair Display',serif;font-size:16px;margin-bottom:16px">ğŸš€ 5-Minute Setup Guide</h3>
          <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px">
            <div style="background:linear-gradient(135deg,#0a1628,#1a3460);color:#fff;border-radius:10px;padding:14px;text-align:center">
              <div style="font-size:20px;margin-bottom:6px">1ï¸âƒ£</div>
              <div style="font-size:11px;font-weight:700;margin-bottom:4px">Create Sheet</div>
              <div style="font-size:10.5px;opacity:.7">Open Google Sheets â†’ New spreadsheet â†’ name it "SFS_Data"</div>
            </div>
            <div style="background:linear-gradient(135deg,#0a1628,#1a3460);color:#fff;border-radius:10px;padding:14px;text-align:center">
              <div style="font-size:20px;margin-bottom:6px">2ï¸âƒ£</div>
              <div style="font-size:11px;font-weight:700;margin-bottom:4px">Open Apps Script</div>
              <div style="font-size:10.5px;opacity:.7">Extensions â†’ Apps Script â†’ Delete default code</div>
            </div>
            <div style="background:linear-gradient(135deg,#0a1628,#1a3460);color:#fff;border-radius:10px;padding:14px;text-align:center">
              <div style="font-size:20px;margin-bottom:6px">3ï¸âƒ£</div>
              <div style="font-size:11px;font-weight:700;margin-bottom:4px">Paste Script</div>
              <div style="font-size:10.5px;opacity:.7">Copy the Apps Script below â†’ Paste â†’ Click Save (Ctrl+S)</div>
            </div>
            <div style="background:linear-gradient(135deg,#0a1628,#1a3460);color:#fff;border-radius:10px;padding:14px;text-align:center">
              <div style="font-size:20px;margin-bottom:6px">4ï¸âƒ£</div>
              <div style="font-size:11px;font-weight:700;margin-bottom:4px">Deploy</div>
              <div style="font-size:10.5px;opacity:.7">Deploy â†’ New Deployment â†’ Web App â†’ Anyone â†’ Deploy â†’ Copy URL</div>
            </div>
            <div style="background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--navy);border-radius:10px;padding:14px;text-align:center">
              <div style="font-size:20px;margin-bottom:6px">5ï¸âƒ£</div>
              <div style="font-size:11px;font-weight:700;margin-bottom:4px">Paste in APP_CONFIG</div>
              <div style="font-size:10.5px;opacity:.8">Open HTML source â†’ find APP_CONFIG â†’ paste URL in SHEETS_WEBHOOK</div>
            </div>
          </div>
          <div style="background:#ecfdf5;border:1px solid #6ee7b7;border-radius:8px;padding:12px 16px;font-size:12.5px;color:#065f46">
            ğŸ’¡ <strong>Also edit APP_CONFIG for:</strong> &nbsp; UPI_ID (your UPI address) &nbsp;Â·&nbsp; UPI_NAME (your name) &nbsp;Â·&nbsp; REPORT_PRICE (default â‚¹199) &nbsp;Â·&nbsp; ADMIN_EMAIL &amp; ADMIN_PASS
          </div>
        </div>

        <!-- Apps Script code -->
        <div class="admin-table-wrap" style="padding:22px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
            <h3 style="font-family:'Playfair Display',serif;font-size:15px">ğŸ“‹ Google Apps Script Code (copy and paste into Apps Script)</h3>
            <button onclick="copyAppsScript()" id="copy-as-btn" style="background:var(--navy);color:#fff;border:none;padding:8px 16px;border-radius:7px;font-size:12.5px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600">ğŸ“‹ Copy Script</button>
          </div>
          <pre id="apps-script-code" style="background:#0d1117;color:#c9d1d9;padding:20px;border-radius:10px;font-size:11.5px;line-height:1.75;overflow-x:auto;white-space:pre;max-height:500px;overflow-y:auto;font-family:'DM Mono',monospace">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEKHAR FINANCIAL SERVICES â€” Google Apps Script Webhook
// Automatically saves all user events to separate Google Sheets tabs
// Deploy as Web App: Execute as Me | Who can access: Anyone
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function doPost(e) {
  try {
    const raw   = e.postData ? e.postData.contents : '{}';
    const data  = JSON.parse(raw);
    const event = data.event || 'UNKNOWN';
    const ss    = SpreadsheetApp.getActiveSpreadsheet();

    // Route to correct handler
    const handlers = {
      REGISTRATION:   handleRegistration,
      LOGIN:          handleLogin,
      ASSESSMENT:     handleAssessment,
      REPORT_PAYMENT: handlePayment,
      SUBSCRIPTION:   handleSubscription,
    };

    if (handlers[event]) handlers[event](ss, data);

    return ContentService
      .createTextOutput(JSON.stringify({ status:'ok', event }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    Logger.log(err.toString());
    return ContentService
      .createTextOutput(JSON.stringify({ status:'error', msg: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// REGISTRATIONS â€” every new user signup
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleRegistration(ss, d) {
  const s = getSheet(ss, 'ğŸ“ Registrations');
  ensureHeader(s, [
    'Timestamp','Name','Email','Mobile','Password (hint)',
    'Referral Code','Plan','Source','Registered At'
  ]);
  s.appendRow([
    d.timestamp, d.name, d.email, d.mobile || '',
    d.password_hint || '', d.referral || '',
    d.plan || 'free', d.source || 'web', d.registered || d.timestamp
  ]);
  autoStyle(s);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOGINS â€” every login event
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleLogin(ss, d) {
  const s = getSheet(ss, 'ğŸ” Logins');
  ensureHeader(s, ['Timestamp','Name','Email','Mobile','Plan','Login Time']);
  s.appendRow([d.timestamp, d.name, d.email, d.mobile || '', d.plan || '', d.lastLogin || d.timestamp]);
  autoStyle(s);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ASSESSMENTS â€” full financial data on every report generation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleAssessment(ss, d) {
  const s = getSheet(ss, 'ğŸ“Š Assessments');
  ensureHeader(s, [
    'Timestamp','Name','Email','Mobile','DOB','Plan',
    // Income
    'Salary/mo','Rental/mo','Other Income/mo','Annual Gross','Spouse Income','Total Income/mo',
    // Expenses
    'Household','Education','Medical','Lifestyle','Ins Premium','Other Exp','Total Expenses',
    // Loans
    'Home Loan Bal','Home EMI','Personal Loan','Personal EMI','Car Loan','Car EMI','Total EMI',
    // Insurance
    'Life SA','Health Cover','Has Term Ins',
    // Investments
    'Emergency Fund','MF Corpus','EPF/PPF','FD/Bonds','Total Corpus','Monthly SIP','Risk Profile',
    // Key metrics
    'Monthly Surplus','Debt Ratio %','Emergency Months','Health Score','Assessments Done'
  ]);
  s.appendRow([
    d.timestamp, d.name, d.email, d.mobile || '', d.dob || '', d.plan || 'free',
    d.monthly_salary||0, d.rental_income||0, d.other_income||0, d.annual_gross||0, d.spouse_income||0, d.total_income||0,
    d.household_exp||0, d.edu_exp||0, d.medical_exp||0, d.lifestyle_exp||0, d.insurance_prem||0, d.other_exp||0, d.total_expenses||0,
    d.home_loan_bal||0, d.home_emi||0, d.personal_loan||0, d.personal_emi||0, d.car_loan||0, d.car_emi||0, d.total_emi||0,
    d.life_sa||0, d.health_cover||0, d.term_insurance||'',
    d.emergency_fund||0, d.mf_corpus||0, d.epf_ppf||0, d.fd_corpus||0, d.total_corpus||0, d.monthly_sip||0, d.risk_profile||'',
    d.monthly_surplus||0, d.debt_ratio_pct||0, d.emg_months||0, d.health_score||0, d.assessment_count||1
  ]);
  autoStyle(s);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAYMENTS â€” â‚¹199 report payment with UTR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handlePayment(ss, d) {
  const s = getSheet(ss, 'ğŸ’³ Payments');
  ensureHeader(s, ['Timestamp','Name','Email','Mobile','Amount (â‚¹)','UTR / Txn ID','UPI ID','Plan','Registered','Status']);
  s.appendRow([
    d.timestamp, d.name, d.email, d.mobile || '',
    d.amount || 199, d.utr || '', d.upi_id || '',
    d.plan || 'free', d.registered || '', d.status || 'pending_verification'
  ]);
  autoStyle(s);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SUBSCRIPTIONS â€” plan upgrade requests
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleSubscription(ss, d) {
  const s = getSheet(ss, 'â­ Subscriptions');
  ensureHeader(s, ['Timestamp','Name','Email','Mobile','Plan','Price (â‚¹)','Method','Message','Status']);
  s.appendRow([
    d.timestamp, d.name, d.email, d.mobile || '',
    d.plan || '', d.price || '', d.method || 'manual',
    d.message || '', d.status || 'pending'
  ]);
  autoStyle(s);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getSheet(ss, name) {
  return ss.getSheetByName(name) || ss.insertSheet(name);
}

function ensureHeader(sheet, cols) {
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(cols);
    const hdr = sheet.getRange(1, 1, 1, cols.length);
    hdr.setFontWeight('bold')
       .setBackground('#0a1628')
       .setFontColor('#c9a84c')
       .setFontSize(11);
    sheet.setFrozenRows(1);
  }
}

function autoStyle(sheet) {
  if (sheet.getLastRow() > 1) {
    sheet.getRange(sheet.getLastRow(), 1, 1, sheet.getLastColumn())
         .setBackground(sheet.getLastRow() % 2 === 0 ? '#f8f5ee' : '#ffffff');
  }
  sheet.autoResizeColumns(1, sheet.getLastColumn());
}

// Test function â€” run manually to verify deployment works
function testPost() {
  const testData = {
    event: 'REGISTRATION', timestamp: new Date().toISOString(),
    name: 'Test User', email: '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d6a2b3a5a296a2b3a5a2f8b5b9bb">[email&#160;protected]</a>', mobile: '9999999999',
    plan: 'free', source: 'test'
  };
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  handleRegistration(ss, testData);
  Logger.log('Test entry written successfully');
}</pre>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- USER DETAIL MODAL -->
<div class="modal-overlay" id="userModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3>Client Financial Profile â€” <span id="modal-client-name"></span></h3>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body-content"></div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  â–¶â–¶  APP_CONFIG â€” EDIT THESE BEFORE GOING LIVE  â—€â—€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const APP_CONFIG = {
  // â”€â”€ 1. Google Sheets (Apps Script Webhook) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Follow the 5-step guide in Admin â†’ Setup Guide to get this URL
  SHEETS_WEBHOOK: 'YOUR_APPS_SCRIPT_WEBHOOK_URL',

  // â”€â”€ 2. UPI Payment Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  UPI_ID:       '9848996404@ybl',
  UPI_NAME:     'Sekhar Financial Services',
  REPORT_PRICE: 199,                        // â‚¹ per report

  // â”€â”€ 3. Admin credentials â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ADMIN_EMAIL: 'admin@sekharfinancial.com',
  ADMIN_PASS:  'Admin@SFS2024!',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GOOGLE SHEETS â€” Fire-and-forget webhook
//  Posts JSON to Apps Script; fails silently so it never blocks user
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function pushToSheets(eventType, payload) {
  if (!APP_CONFIG.SHEETS_WEBHOOK || APP_CONFIG.SHEETS_WEBHOOK === 'YOUR_APPS_SCRIPT_WEBHOOK_URL') return;
  try {
    await fetch(APP_CONFIG.SHEETS_WEBHOOK, {
      method: 'POST',
      mode:   'no-cors',   // Apps Script doesn't need CORS preflight
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ event: eventType, timestamp: new Date().toISOString(), ...payload }),
    });
  } catch (_) { /* never block user for analytics */ }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA LAYER â€” localStorage (local backup + app state)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB = {
  getUsers:     ()    => JSON.parse(localStorage.getItem('sfs_users')          || '{}'),
  saveUsers:    (u)   => localStorage.setItem('sfs_users',     JSON.stringify(u)),
  getSession:   ()    => JSON.parse(localStorage.getItem('sfs_session')         || 'null'),
  saveSession:  (s)   => localStorage.setItem('sfs_session',   JSON.stringify(s)),
  clearSession: ()    => localStorage.removeItem('sfs_session'),
  getUserData:  (e)   => JSON.parse(localStorage.getItem('sfs_data_' + btoa(e)) || '{}'),
  saveUserData: (e,d) => localStorage.setItem('sfs_data_' + btoa(e), JSON.stringify(d)),
  getPayments:  ()    => JSON.parse(localStorage.getItem('sfs_payments')        || '[]'),
  savePayments: (p)   => localStorage.setItem('sfs_payments',  JSON.stringify(p)),
};

// Seed admin account
(function seedAdmin() {
  const users = DB.getUsers();
  if (!users[APP_CONFIG.ADMIN_EMAIL]) {
    users[APP_CONFIG.ADMIN_EMAIL] = {
      name: 'Sekhar Admin', email: APP_CONFIG.ADMIN_EMAIL,
      mobile: '', password: btoa(APP_CONFIG.ADMIN_PASS),
      role: 'admin', plan: 'elite',
      registered: new Date().toISOString(), lastLogin: null, assessments: 0, score: null
    };
    DB.saveUsers(users);
  }
})();

let currentUser = null;
let formData = {};
let autoSaveTimer = null;
let mfCount = 0, etfCount = 0, stockCount = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  document.querySelectorAll('.landing-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(t => t.classList.remove('active'));
  document.querySelector(`.landing-tab:${tab === 'login' ? 'first-child' : 'last-child'}`).classList.add('active');
  document.getElementById('tab-' + tab).classList.add('active');
}

function doLogin() {
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const pass  = document.getElementById('login-pass').value;
  const msg   = document.getElementById('login-msg');
  const btn   = document.querySelector('#tab-login .auth-btn');
  if (!email || !pass) { msg.textContent = 'Please enter email and password.'; msg.className = 'auth-msg err'; return; }
  const users = DB.getUsers();
  const user  = users[email];
  if (!user || user.password !== btoa(pass)) {
    msg.textContent = 'Invalid email or password.'; msg.className = 'auth-msg err'; return;
  }
  btn.disabled = true; btn.textContent = 'Signing inâ€¦';
  user.lastLogin = new Date().toISOString();
  users[email] = user;
  DB.saveUsers(users);
  DB.saveSession({ email, name: user.name, role: user.role, plan: user.plan });
  currentUser = user;
  msg.textContent = '';

  // â”€â”€ Push login event to Google Sheets â”€â”€
  pushToSheets('LOGIN', {
    name: user.name, email, mobile: user.mobile || '',
    plan: user.plan, lastLogin: user.lastLogin,
  });

  btn.disabled = false; btn.textContent = 'Sign In to My Account â†’';
  if (user.role === 'admin') { loadAdminDash(); showScreen('screen-admin'); }
  else { loadUserDash(); showScreen('screen-dashboard'); }
}

function doRegister() {
  const name   = document.getElementById('reg-name').value.trim();
  const email  = document.getElementById('reg-email').value.trim().toLowerCase();
  const mobile = document.getElementById('reg-mobile').value.trim();
  const pass   = document.getElementById('reg-pass').value;
  const ref    = document.getElementById('reg-ref')?.value.trim() || '';
  const msg    = document.getElementById('reg-msg');
  const btn    = document.querySelector('#tab-register .auth-btn');
  if (!name || !email || !pass) { msg.textContent = 'Please fill all required fields.'; msg.className = 'auth-msg err'; return; }
  if (pass.length < 8) { msg.textContent = 'Password must be at least 8 characters.'; msg.className = 'auth-msg err'; return; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { msg.textContent = 'Please enter a valid email.'; msg.className = 'auth-msg err'; return; }
  const users = DB.getUsers();
  if (users[email]) { msg.textContent = 'An account with this email already exists.'; msg.className = 'auth-msg err'; return; }

  btn.disabled = true; btn.textContent = 'Creating accountâ€¦';
  const registered = new Date().toISOString();
  const newUser = {
    name, email, mobile, password: btoa(pass), referral: ref,
    role: 'user', plan: 'free',
    registered, lastLogin: registered, assessments: 0, score: null
  };
  users[email] = newUser;
  DB.saveUsers(users);
  DB.saveSession({ email, name, role: 'user', plan: 'free' });
  currentUser = newUser;

  // â”€â”€ Push full registration to Google Sheets â”€â”€
  // NOTE: Storing password (base64 encoded) for your recovery purposes.
  // base64 is NOT encryption â€” it's encoding. Keep your Sheet private.
  pushToSheets('REGISTRATION', {
    name, email, mobile, referral: ref,
    password_b64: btoa(pass),   // base64 â€” decode with atob() if needed
    plan: 'free', source: 'web', registered,
  });

  msg.textContent = 'âœ“ Account created successfully!'; msg.className = 'auth-msg ok';
  setTimeout(() => { loadUserDash(); showScreen('screen-dashboard'); btn.disabled = false; btn.textContent = 'Create My Account â†’'; }, 800);
}

function doLogout() {
  DB.clearSession(); currentUser = null;
  showScreen('screen-landing');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USER DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadUserDash() {
  const session = DB.getSession();
  if (!session) return;
  const users = DB.getUsers();
  currentUser = users[session.email];
  document.getElementById('dash-username').textContent = currentUser.name.split(' ')[0];
  document.getElementById('dash-name').textContent = currentUser.name.split(' ')[0];
  document.getElementById('app-username').textContent = currentUser.name.split(' ')[0];
  const isPrem = currentUser.plan !== 'free';
  document.getElementById('dash-plan-badge').textContent = isPrem ? currentUser.plan.toUpperCase() : 'FREE';
  document.getElementById('dash-plan-badge').className = 'plan-badge ' + (isPrem ? 'plan-premium' : 'plan-free');
  document.getElementById('d_plan').textContent = isPrem ? currentUser.plan.charAt(0).toUpperCase() + currentUser.plan.slice(1) : 'Free';

  const ud = DB.getUserData(currentUser.email);
  if (ud.lastReport) {
    const r = ud.lastReport;
    document.getElementById('d_score').textContent = (r.score || 'â€”') + (r.score ? '/100' : '');
    document.getElementById('d_surplus').textContent = r.surplus ? fmt(r.surplus) : 'â€”';
    document.getElementById('d_corpus').textContent = r.corpus ? fmt(r.corpus) : 'â€”';
    document.getElementById('d_ins').textContent = r.insStatus || 'â€”';
    document.getElementById('d_emg').textContent = r.emgMonths ? r.emgMonths.toFixed(1) + ' mo' : 'â€”';
  }
  // History
  const history = ud.history || [];
  document.getElementById('rh-count').textContent = history.length + ' assessment(s)';
  document.getElementById('rh-list').innerHTML = history.length === 0
    ? '<div style="padding:24px;text-align:center;color:var(--text-light);font-size:13px">No assessments yet. Start your first financial assessment!</div>'
    : history.slice().reverse().map(h =>
      `<div class="rh-item">
        <div><div class="ri-name">${currentUser.name}</div><div class="ri-date">${new Date(h.date).toLocaleDateString('en-IN', {day:'2-digit',month:'short',year:'numeric'})}</div></div>
        <div class="ri-score">${h.score}/100</div>
        <div class="ri-actions"><button class="btn-view" onclick="loadAndViewReport('${h.date}')">View Report</button></div>
      </div>`).join('');
}

function startApp() {
  const session = DB.getSession();
  if (!session) { showScreen('screen-landing'); return; }
  currentUser = DB.getUsers()[session.email];
  loadFormData();
  buildForm();
  showScreen('screen-app');
}

function showPricing() {
  updatePricingUI();
  showScreen('screen-pricing');
}

function updatePricingUI() {
  if (!currentUser) return;
  const plan = currentUser.plan || 'free';
  const names = { free:'Basic (Free)', professional:'Professional (â‚¹999/yr)', elite:'Elite (â‚¹2,999/yr)' };
  const el = id => document.getElementById(id);
  if (el('cp-name')) el('cp-name').textContent = names[plan] || 'Basic (Free)';
  // Update button states
  ['basic','professional','elite'].forEach(p => {
    const btn = el('pc-' + p + '-btn');
    if (!btn) return;
    if (p === plan || (p === 'basic' && plan === 'free')) {
      btn.textContent = 'âœ“ Current Plan';
      btn.style.opacity = '.55';
      btn.style.cursor = 'not-allowed';
      btn.disabled = true;
    } else {
      btn.disabled = false;
      btn.style.opacity = '1';
      btn.style.cursor = 'pointer';
    }
  });
  // Show expiry if premium
  const ud = DB.getUserData(currentUser.email);
  if (el('cp-expiry') && ud.planExpiry) {
    el('cp-expiry').textContent = 'Valid till: ' + new Date(ud.planExpiry).toLocaleDateString('en-IN', { day:'2-digit', month:'long', year:'numeric' });
  }
}

let _selectedPlan = '';
function selectPlan(plan) {
  if (!currentUser) return;
  if (plan === currentUser.plan || (plan === 'basic' && currentUser.plan === 'free')) return;
  _selectedPlan = plan;
  const prices = { basic:'Free', professional:'â‚¹999/year + GST', elite:'â‚¹2,999/year + GST' };
  const features = {
    professional: 'Unlimited Assessments Â· Portfolio Review Â· Education Planner Â· PDF Downloads Â· Priority Support',
    elite: 'Everything in Professional Â· 2 Advisor Sessions Â· Tax Planning Â· WhatsApp Alerts Â· Dedicated Support',
    basic: 'Free forever â€” basic assessment and report'
  };
  const title = document.getElementById('sub-modal-title');
  const summary = document.getElementById('sub-plan-summary');
  if (title) title.textContent = `Subscribe to ${plan.charAt(0).toUpperCase()+plan.slice(1)} Plan`;
  if (summary) summary.innerHTML = `
    <div style="font-weight:700;color:var(--navy);font-size:15px;margin-bottom:4px">${plan.charAt(0).toUpperCase()+plan.slice(1)} â€” ${prices[plan]}</div>
    <div style="font-size:12px;color:var(--text-mid);line-height:1.7">${features[plan]}</div>
  `;
  const nameEl = document.getElementById('sub-name');
  const emailEl = document.getElementById('sub-email');
  const mobEl = document.getElementById('sub-mobile');
  if (nameEl) nameEl.value = currentUser.name || '';
  if (emailEl) emailEl.value = currentUser.email || '';
  if (mobEl) mobEl.value = currentUser.mobile || '';
  const successEl = document.getElementById('sub-success');
  if (successEl) successEl.style.display = 'none';
  const modal = document.getElementById('subscribeModal');
  if (modal) { modal.style.display = 'flex'; }
}

function closeSubModal() {
  const modal = document.getElementById('subscribeModal');
  if (modal) modal.style.display = 'none';
}

function submitSubscription() {
  if (!currentUser || !_selectedPlan) return;
  const mobile = document.getElementById('sub-mobile')?.value?.trim() || '';
  const msg = document.getElementById('sub-msg')?.value?.trim() || '';
  // Save subscription request in localStorage for admin to see
  const users = DB.getUsers();
  const user = users[currentUser.email];
  if (!user) return;
  if (!user.subscriptionRequests) user.subscriptionRequests = [];
  user.subscriptionRequests.push({
    plan: _selectedPlan,
    requestedAt: new Date().toISOString(),
    mobile,
    message: msg,
    status: 'pending'
  });
  DB.saveUsers(users);
  // Show success
  const successEl = document.getElementById('sub-success');
  if (successEl) successEl.style.display = 'block';
  setTimeout(() => closeSubModal(), 3000);
}

// Admin: manually activate a subscription after payment received
function adminActivateSub(email, plan) {
  const users = DB.getUsers();
  if (!users[email]) return;
  const expiry = new Date();
  expiry.setFullYear(expiry.getFullYear() + 1);
  users[email].plan = plan;
  DB.saveUsers(users);
  // Save expiry in user data
  const ud = DB.getUserData(email);
  ud.planExpiry = expiry.toISOString();
  ud.planActivated = new Date().toISOString();
  DB.saveUserData(email, ud);
  alert(`âœ… ${users[email].name} activated on ${plan.toUpperCase()} until ${expiry.toLocaleDateString('en-IN')}`);
  loadAdminDash();
}


function viewReport() {
  const ud = DB.getUserData(currentUser.email);
  if (!ud.formData) { alert('No assessment data found. Please complete your financial assessment first.'); return; }
  formData = ud.formData;
  generateAndShowReport();
}

function loadAndViewReport(date) {
  viewReport();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORM BUILD & DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const NAV_STEPS = ['Personal','Income','Expenses','Loans','Insurance','Goals','Education','Investments','Portfolio','Risk & Estate','Generate'];
const CLASS_LIST = ['KG / Pre-School','Class 1','Class 2','Class 3','Class 4','Class 5','Class 6','Class 7','Class 8','Class 9','Class 10','Class 11','Class 12','UG Year 1','UG Year 2','UG Year 3','UG Year 4','PG Year 1','PG Year 2'];
const MF_CATS = ['Large Cap','Mid Cap','Small Cap','Flexi Cap','ELSS','Debt / Liquid','Hybrid','Index Fund','Sectoral','International'];
const ETF_TYPES = ['Nifty 50','Sensex','Nifty Next 50','Gold ETF','Silver ETF','Banking ETF','IT ETF','PSU ETF','Debt ETF','International ETF'];
const SECTORS = ['Banking / Finance','IT / Technology','Pharma','FMCG','Auto','Energy','Infrastructure','Metals','Telecom','Real Estate','Diversified'];
let currentStep = 0;

function buildForm() {
  document.getElementById('navBar').innerHTML = NAV_STEPS.map((s, i) =>
    `<div class="nav-step ${i === 0 ? 'active' : ''}" id="navStep${i}" onclick="goTo(${i})">${i + 1}. ${s}</div>`
  ).join('');
  document.getElementById('sectionsContainer').innerHTML = buildSections();
  mfCount = 0; etfCount = 0; stockCount = 0;
  restoreFormData();
  addMFRow(); addETFRow(); addStockRow();
  setupAutoSave();
}

function buildSections() {
  return `
<!-- SEC 0: PERSONAL -->
<div class="section-card active" id="sec0">
  <div class="section-header"><div class="section-icon">ğŸ§‘â€ğŸ’¼</div><div class="section-title"><h2>Personal &amp; Family Details</h2><p>Basic information about you and your family</p></div></div>
  <div class="section-body">
    <div class="form-grid">
      <div class="field span-2"><label>Full Name</label><input type="text" id="p_name" oninput="fd('p_name',this.value)"></div>
      <div class="field"><label>Date of Birth</label><input type="date" id="p_dob" oninput="fd('p_dob',this.value)"></div>
      <div class="field"><label>Mobile</label><input type="tel" id="p_mobile" oninput="fd('p_mobile',this.value)"></div>
      <div class="field span-2"><label>Email</label><input type="email" id="p_email" oninput="fd('p_email',this.value)"></div>
      <div class="field"><label>No. of Dependents</label><select id="p_dep" onchange="fd('p_dep',this.value)"><option value="">Select</option><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select></div>
    </div>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ‘©</span> Spouse</div>
    <div class="form-grid">
      <div class="field span-2"><label>Spouse Name</label><input type="text" id="sp_name" oninput="fd('sp_name',this.value)"></div>
      <div class="field"><label>Spouse DOB</label><input type="date" id="sp_dob" oninput="fd('sp_dob',this.value)"></div>
      <div class="field"><label>Spouse Working?</label><select id="sp_work" onchange="fd('sp_work',this.value);toggleSI()"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field" id="sp_inc_f" style="display:none"><label>Spouse Income (â‚¹/mo)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="sp_inc" oninput="fd('sp_inc',this.value);calcIncome()"></div></div>
    </div>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ‘¶</span> Children</div>
    <div class="form-grid">
      <div class="field span-2"><label>Child 1 Name</label><input type="text" id="c1n" oninput="fd('c1n',this.value)"></div>
      <div class="field"><label>Child 1 DOB</label><input type="date" id="c1d" oninput="fd('c1d',this.value)"></div>
      <div class="field span-2"><label>Child 2 Name</label><input type="text" id="c2n" oninput="fd('c2n',this.value)"></div>
      <div class="field"><label>Child 2 DOB</label><input type="date" id="c2d" oninput="fd('c2d',this.value)"></div>
    </div>
    <div class="divider"></div>
    <div class="form-grid form-grid-2">
      <div class="field"><label>Parents Dependent?</label><select id="par_dep" onchange="fd('par_dep',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Parents Age</label><input type="text" id="par_age" placeholder="68 / 65" oninput="fd('par_age',this.value)"></div>
    </div>
    <div class="btn-row"><div></div><button class="btn btn-primary" onclick="goTo(1)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 1: INCOME -->
<div class="section-card" id="sec1">
  <div class="section-header"><div class="section-icon">ğŸ’¼</div><div class="section-title"><h2>Income Details</h2><p>Monthly and annual income from all sources</p></div></div>
  <div class="section-body">
    <div class="form-grid form-grid-2">
      <div class="field"><label>Net Monthly Salary (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="i_sal" oninput="fd('i_sal',this.value);calcIncome()"></div></div>
      <div class="field"><label>Annual Gross Income (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="i_gross" oninput="fd('i_gross',this.value)"></div></div>
      <div class="field"><label>Rental Income (â‚¹/mo)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="i_rent" oninput="fd('i_rent',this.value);calcIncome()"></div></div>
      <div class="field"><label>Business / Other Income (â‚¹/mo)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="i_other" oninput="fd('i_other',this.value);calcIncome()"></div></div>
    </div>
    <div id="inc_box" class="info-box" style="display:none">ğŸ“Š <strong>Total Monthly Income:</strong> <span id="inc_disp">â‚¹0</span></div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(0)">â† Back</button><button class="btn btn-primary" onclick="goTo(2)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 2: EXPENSES -->
<div class="section-card" id="sec2">
  <div class="section-header"><div class="section-icon">ğŸ’¸</div><div class="section-title"><h2>Monthly Expenses</h2><p>All regular monthly outflows</p></div></div>
  <div class="section-body">
    <div class="form-grid form-grid-2">
      <div class="field"><label>Household (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_hh" oninput="fd('e_hh',this.value);calcExp()"></div></div>
      <div class="field"><label>Education Fees (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_edu" oninput="fd('e_edu',this.value);calcExp()"></div></div>
      <div class="field"><label>Medical (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_med" oninput="fd('e_med',this.value);calcExp()"></div></div>
      <div class="field"><label>Lifestyle / Discretionary (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_life" oninput="fd('e_life',this.value);calcExp()"></div></div>
      <div class="field"><label>Insurance Premiums (â‚¹/mo)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_ins" oninput="fd('e_ins',this.value);calcExp()"></div></div>
      <div class="field"><label>Other (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="e_oth" oninput="fd('e_oth',this.value);calcExp()"></div></div>
    </div>
    <div id="exp_box" class="info-box" style="display:none">ğŸ“Š <strong>Total Expenses:</strong> <span id="exp_disp">â‚¹0</span></div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(1)">â† Back</button><button class="btn btn-primary" onclick="goTo(3)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 3: LOANS -->
<div class="section-card" id="sec3">
  <div class="section-header"><div class="section-icon">ğŸ¦</div><div class="section-title"><h2>Loans &amp; Liabilities</h2><p>Outstanding loans and EMI obligations</p></div></div>
  <div class="section-body">
    <div class="sub-heading"><span>ğŸ </span> Home Loan</div>
    <div class="form-grid"><div class="field"><label>Balance (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_hbal" oninput="fd('l_hbal',this.value)"></div></div><div class="field"><label>ROI (%)</label><input type="number" id="l_hroi" step="0.1" oninput="fd('l_hroi',this.value)"></div><div class="field"><label>EMI (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_hemi" oninput="fd('l_hemi',this.value);calcEmi()"></div></div></div>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ‘¤</span> Personal Loan</div>
    <div class="form-grid form-grid-2"><div class="field"><label>Balance (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_pbal" oninput="fd('l_pbal',this.value)"></div></div><div class="field"><label>EMI (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_pemi" oninput="fd('l_pemi',this.value);calcEmi()"></div></div></div>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸš—</span> Car Loan</div>
    <div class="form-grid form-grid-2"><div class="field"><label>Balance (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_cbal" oninput="fd('l_cbal',this.value)"></div></div><div class="field"><label>EMI (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="l_cemi" oninput="fd('l_cemi',this.value);calcEmi()"></div></div></div>
    <div id="emi_box" class="info-box" style="display:none">ğŸ“Š <strong>Total EMI:</strong> <span id="emi_disp">â‚¹0</span></div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(2)">â† Back</button><button class="btn btn-primary" onclick="goTo(4)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 4: INSURANCE -->
<div class="section-card" id="sec4">
  <div class="section-header"><div class="section-icon">ğŸ›¡ï¸</div><div class="section-title"><h2>Insurance Details</h2><p>Life, health and general insurance</p></div></div>
  <div class="section-body">
    <div class="sub-heading"><span>â¤ï¸</span> Life Insurance</div>
    <div class="form-grid form-grid-2">
      <div class="field"><label>Total Sum Assured (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="ins_sa" oninput="fd('ins_sa',this.value)"></div></div>
      <div class="field"><label>Annual Premium (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="ins_prem" oninput="fd('ins_prem',this.value)"></div></div>
    </div>
    <div class="form-grid" style="margin-top:12px">
      <div class="field"><label>Term Insurance?</label><div class="check-group"><label class="check-item"><input type="radio" name="term_ins" value="yes" id="ti_y" onchange="fd('term_ins','yes')"> <label for="ti_y">Yes</label></label><label class="check-item"><input type="radio" name="term_ins" value="no" id="ti_n" checked onchange="fd('term_ins','no')"> <label for="ti_n">No</label></label></div></div>
      <div class="field"><label>All Nominees Updated?</label><div class="check-group"><label class="check-item"><input type="radio" name="nominee" value="yes" onchange="fd('nominee','yes')"> <label>Yes</label></label><label class="check-item"><input type="radio" name="nominee" value="no" checked onchange="fd('nominee','no')"> <label>No</label></label></div></div>
    </div>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ¥</span> Health Insurance</div>
    <div class="form-grid form-grid-2">
      <div class="field"><label>Total Health Cover (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="ins_hc" oninput="fd('ins_hc',this.value)"></div></div>
      <div class="field"><label>Coverage Type</label><select id="ins_ht" onchange="fd('ins_ht',this.value)"><option value="">Select</option><option>Individual</option><option>Family Floater</option></select></div>
      <div class="field"><label>Employer Health Insurance?</label><select id="ins_emp" onchange="fd('ins_emp',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Super Top-Up?</label><select id="ins_tu" onchange="fd('ins_tu',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Pre-existing Disease?</label><select id="ins_ped" onchange="fd('ins_ped',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Critical Illness Cover?</label><select id="ins_ci" onchange="fd('ins_ci',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Personal Accident Policy?</label><select id="ins_pa" onchange="fd('ins_pa',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
    </div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(3)">â† Back</button><button class="btn btn-primary" onclick="goTo(5)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 5: GOALS -->
<div class="section-card" id="sec5">
  <div class="section-header"><div class="section-icon">ğŸ¯</div><div class="section-title"><h2>Financial Goals</h2><p>Key goals excluding child education (handled next)</p></div></div>
  <div class="section-body">
    <div class="form-grid form-grid-2" style="margin-bottom:18px">
      <div class="field"><label>General Inflation (%)</label><div class="pct-field"><span class="pc">%</span><input type="number" id="g_infl" value="6" step="0.5" oninput="fd('g_infl',this.value)"></div></div>
      <div class="field"><label>Expected Return (%)</label><div class="pct-field"><span class="pc">%</span><input type="number" id="g_ret" value="12" step="0.5" oninput="fd('g_ret',this.value)"></div></div>
    </div>
    ${[['Home Purchase / Renovation','ğŸ '],['Retirement Corpus','ğŸŒ…'],['Vehicle Purchase','ğŸš—'],['International Travel','âœˆï¸'],['Business / Other','ğŸ’¼']].map((g,i)=>`
    <div class="goal-row"><div class="goal-label">${g[1]} Goal ${i+1}</div>
    <div class="form-grid form-grid-4">
      <div class="field"><label>Name</label><input type="text" id="g${i+1}n" value="${g[0]}" oninput="fd('g${i+1}n',this.value)"></div>
      <div class="field"><label>Target Year</label><input type="number" id="g${i+1}y" placeholder="${new Date().getFullYear()+5+i*3}" oninput="fd('g${i+1}y',this.value)"></div>
      <div class="field"><label>Today's Cost (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="g${i+1}c" oninput="fd('g${i+1}c',this.value)"></div></div>
      <div class="field"><label>Priority</label><select id="g${i+1}p" onchange="fd('g${i+1}p',this.value)"><option value="high">High</option><option value="medium" selected>Medium</option><option value="low">Low</option></select></div>
    </div></div>`).join('')}
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(4)">â† Back</button><button class="btn btn-primary" onclick="goTo(6)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 6: EDUCATION -->
<div class="section-card" id="sec6">
  <div class="section-header"><div class="section-icon">ğŸ“</div><div class="section-title"><h2>Child Education Planner</h2><p>Year-by-year fee planning with SIP &amp; redemption schedule</p></div></div>
  <div class="section-body">
    <div class="info-box">ğŸ“Œ Enter today's fee per class. System will auto-calculate inflation-adjusted fees, required monthly SIP, and year-wise redemption amounts.</div>
    <div class="form-grid form-grid-2" style="margin-bottom:18px">
      <div class="field"><label>Education Inflation (%)</label><div class="pct-field"><span class="pc">%</span><input type="number" id="edu_infl" value="10" step="0.5" oninput="fd('edu_infl',this.value)"></div></div>
      <div class="field"><label>Expected Return (%)</label><div class="pct-field"><span class="pc">%</span><input type="number" id="edu_ret" value="12" step="0.5" oninput="fd('edu_ret',this.value)"></div></div>
    </div>
    <div id="edu_container"></div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(5)">â† Back</button><button class="btn btn-primary" onclick="goTo(7)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 7: INVESTMENTS -->
<div class="section-card" id="sec7">
  <div class="section-header"><div class="section-icon">ğŸ“ˆ</div><div class="section-title"><h2>Existing Investments</h2><p>Current corpus and portfolio summary</p></div></div>
  <div class="section-body">
    <div class="form-grid form-grid-2">
      <div class="field"><label>Monthly SIP (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_sip" oninput="fd('inv_sip',this.value)"></div></div>
      <div class="field"><label>MF Corpus (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_mf" oninput="fd('inv_mf',this.value)"></div></div>
      <div class="field"><label>EPF / PPF Balance (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_epf" oninput="fd('inv_epf',this.value)"></div></div>
      <div class="field"><label>NPS (â‚¹ Annual)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_nps" oninput="fd('inv_nps',this.value)"></div></div>
      <div class="field"><label>FD / Savings / Cash (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_fd" oninput="fd('inv_fd',this.value)"></div></div>
      <div class="field"><label>Total Corpus (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="inv_tot" oninput="fd('inv_tot',this.value)"></div></div>
      <div class="field"><label>Risk Profile</label><select id="inv_risk" onchange="fd('inv_risk',this.value)"><option value="">Select</option><option>Safety (Conservative)</option><option>Balance (Moderate)</option><option>Growth (Aggressive)</option></select></div>
      <div class="field"><label>Goals Mapped to Investments?</label><select id="inv_gm" onchange="fd('inv_gm',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
    </div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(6)">â† Back</button><button class="btn btn-primary" onclick="goTo(8)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 8: PORTFOLIO -->
<div class="section-card" id="sec8">
  <div class="section-header"><div class="section-icon">ğŸ“Š</div><div class="section-title"><h2>Portfolio Review â€“ MF / ETF / Stocks</h2><p>Enter holdings for detailed analysis</p></div></div>
  <div class="section-body">
    <div class="warn-box">âš ï¸ Sekhar Financial Services is NOT a SEBI Registered Adviser. All portfolio remarks are for general guidance only.</div>
    <div class="sub-heading"><span>ğŸ›ï¸</span> Mutual Funds</div>
    <div style="overflow-x:auto"><table class="ptable"><thead><tr><th style="min-width:160px">Fund Name</th><th style="min-width:100px">Category</th><th style="min-width:90px">Invested (â‚¹)</th><th style="min-width:90px">Current Value (â‚¹)</th><th style="min-width:80px">SIP (â‚¹)</th><th style="min-width:70px">Yrs</th><th style="min-width:70px">XIRR%</th><th>Del</th></tr></thead><tbody id="mf_body"></tbody></table></div>
    <button class="btn-add" onclick="addMFRow()">+ Add Fund</button>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ“¦</span> ETFs</div>
    <div style="overflow-x:auto"><table class="ptable"><thead><tr><th style="min-width:140px">ETF Name</th><th style="min-width:100px">Type</th><th style="min-width:70px">Units</th><th style="min-width:85px">Avg Price (â‚¹)</th><th style="min-width:85px">Curr Price (â‚¹)</th><th style="min-width:90px">Value</th><th style="min-width:65px">Gain%</th><th>Del</th></tr></thead><tbody id="etf_body"></tbody></table></div>
    <button class="btn-add" onclick="addETFRow()">+ Add ETF</button>
    <div class="divider"></div>
    <div class="sub-heading"><span>ğŸ“ˆ</span> Stocks</div>
    <div style="overflow-x:auto"><table class="ptable"><thead><tr><th style="min-width:110px">Stock</th><th style="min-width:90px">Sector</th><th style="min-width:55px">Qty</th><th style="min-width:85px">Avg Price (â‚¹)</th><th style="min-width:85px">Curr Price (â‚¹)</th><th style="min-width:85px">Invested</th><th style="min-width:85px">Value</th><th style="min-width:65px">P&L%</th><th>Del</th></tr></thead><tbody id="stock_body"></tbody></table></div>
    <button class="btn-add" onclick="addStockRow()">+ Add Stock</button>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(7)">â† Back</button><button class="btn btn-primary" onclick="goTo(9)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 9: RISK -->
<div class="section-card" id="sec9">
  <div class="section-header"><div class="section-icon">âš ï¸</div><div class="section-title"><h2>Risk, Emergency &amp; Estate</h2><p>Emergency fund, health risk, estate planning</p></div></div>
  <div class="section-body">
    <div class="form-grid form-grid-2">
      <div class="field"><label>Emergency Fund Available?</label><select id="r_ef" onchange="fd('r_ef',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Emergency Fund Amount (â‚¹)</label><div class="rupee-field"><span class="rs">â‚¹</span><input type="number" id="r_efa" oninput="fd('r_efa',this.value)"></div></div>
      <div class="field"><label>Job Risk Level</label><select id="r_job" onchange="fd('r_job',this.value)"><option value="">Select</option><option>Low</option><option>Medium</option><option>High</option></select></div>
      <div class="field"><label>Major Concern</label><select id="r_conc" onchange="fd('r_conc',this.value)"><option value="">Select</option><option>Health</option><option>Education</option><option>EMI / Debt</option><option>Retirement</option><option>Wealth Creation</option><option>Tax Saving</option></select></div>
      <div class="field"><label>Will Executed?</label><select id="r_will" onchange="fd('r_will',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Succession Plan?</label><select id="r_succ" onchange="fd('r_succ',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>Tax Harvesting Awareness?</label><select id="r_th" onchange="fd('r_th',this.value)"><option value="no">No</option><option value="yes">Yes</option></select></div>
      <div class="field"><label>KYC / Nominees Correct?</label><select id="r_kyc" onchange="fd('r_kyc',this.value)"><option value="needs_check">Needs Check</option><option value="yes">Yes</option><option value="correction">Needs Correction</option></select></div>
    </div>
    <div class="btn-row"><button class="btn btn-outline" onclick="goTo(8)">â† Back</button><button class="btn btn-primary" onclick="goTo(10)">Next â†’</button></div>
  </div>
</div>

<!-- SEC 10: GENERATE -->
<div class="section-card" id="sec10">
  <div class="section-header"><div class="section-icon">ğŸš€</div><div class="section-title"><h2>Generate Your Financial Report</h2><p>Review summary and generate your comprehensive plan</p></div></div>
  <div class="section-body">
    <div class="info-box">âœ… All sections saved. Click below to generate your personalised financial report.</div>
    <div id="review_grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px"></div>
    <div class="warn-box">ğŸ” <strong>Cyber Security:</strong> OTPs will never be shared. No suspicious links will be clicked. National Cyber Crime Helpline: <strong>1930</strong></div>
    <div class="privacy-banner" style="margin-top:16px">
      <div class="pb-icon">ğŸ”’</div>
      <div><h3>Your Data is Saved & Private</h3><p>All your information has been saved securely to your account. Only you can access and view this data when logged in. Your data is never shared with third parties.</p></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-outline" onclick="goTo(9)">â† Back</button>
      <button class="btn-generate btn" onclick="generateAndShowReport()">ğŸš€ Generate Comprehensive Financial Report</button>
    </div>
  </div>
</div>
`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goTo(step) {
  document.querySelectorAll('.section-card').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-step').forEach((n, i) => {
    n.classList.remove('active', 'done');
    if (i < step) n.classList.add('done');
  });
  const sec = document.getElementById('sec' + step);
  if (sec) sec.classList.add('active');
  document.getElementById('navStep' + step)?.classList.add('active');
  if (step === 6) setTimeout(buildEduPlanner, 50);
  if (step === 10) buildReviewGrid();
  currentStep = step;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORM DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fd(key, val) {
  formData[key] = val;
  scheduleSave();
}

function nf(key) { return parseFloat(formData[key]) || 0; }
function vf(key) { return formData[key] || ''; }

function scheduleSave() {
  document.getElementById('saveDot').className = 'save-dot saving';
  document.getElementById('saveStatus').textContent = 'Savingâ€¦';
  clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(saveFormData, 1200);
}

function setupAutoSave() {
  setInterval(() => {
    capturePortfolioToFormData();
    saveFormData();
  }, 30000);
}

function saveFormData() {
  if (!currentUser) return;
  capturePortfolioToFormData();
  const ud = DB.getUserData(currentUser.email);
  ud.formData = formData;
  ud.lastSaved = new Date().toISOString();
  DB.saveUserData(currentUser.email, ud);
  document.getElementById('saveDot').className = 'save-dot';
  document.getElementById('saveStatus').textContent = 'All changes saved';
}

function loadFormData() {
  if (!currentUser) return;
  const ud = DB.getUserData(currentUser.email);
  formData = ud.formData || {};
}

function restoreFormData() {
  Object.keys(formData).forEach(key => {
    const el = document.getElementById(key);
    if (!el) return;
    if (el.type === 'radio') {
      const r = document.querySelector(`input[name="${el.name}"][value="${formData[key]}"]`);
      if (r) r.checked = true;
    } else {
      el.value = formData[key];
    }
  });
  if (formData.sp_work === 'yes') document.getElementById('sp_inc_f').style.display = 'block';
  calcIncome(); calcExp(); calcEmi();
}

function capturePortfolioToFormData() {
  const mfs = [], etfs = [], stocks = [];
  for (let i = 1; i <= mfCount; i++) {
    if (!document.getElementById(`mf_row_${i}`)) continue;
    mfs.push({ name: document.getElementById(`mf_name_${i}`)?.value, cat: document.getElementById(`mf_cat_${i}`)?.value, inv: document.getElementById(`mf_inv_${i}`)?.value, cur: document.getElementById(`mf_cur_${i}`)?.value, sip: document.getElementById(`mf_sip_${i}`)?.value, dur: document.getElementById(`mf_dur_${i}`)?.value, xirr: document.getElementById(`mf_xirr_${i}`)?.value });
  }
  for (let i = 1; i <= etfCount; i++) {
    if (!document.getElementById(`etf_row_${i}`)) continue;
    etfs.push({ name: document.getElementById(`etf_name_${i}`)?.value, type: document.getElementById(`etf_type_${i}`)?.value, units: document.getElementById(`etf_units_${i}`)?.value, avg: document.getElementById(`etf_avg_${i}`)?.value, cur: document.getElementById(`etf_cur_${i}`)?.value });
  }
  for (let i = 1; i <= stockCount; i++) {
    if (!document.getElementById(`stock_row_${i}`)) continue;
    stocks.push({ name: document.getElementById(`st_name_${i}`)?.value, sec: document.getElementById(`st_sec_${i}`)?.value, qty: document.getElementById(`st_qty_${i}`)?.value, avg: document.getElementById(`st_avg_${i}`)?.value, cur: document.getElementById(`st_cur_${i}`)?.value });
  }
  formData._mfs = mfs; formData._etfs = etfs; formData._stocks = stocks;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmt(v) {
  if (!v || isNaN(v)) return 'â‚¹0';
  if (v >= 10000000) return 'â‚¹' + (v/10000000).toFixed(2) + ' Cr';
  if (v >= 100000) return 'â‚¹' + (v/100000).toFixed(2) + ' L';
  return 'â‚¹' + Math.round(v).toLocaleString('en-IN');
}
function pct(v, d=1) { return (v||0).toFixed(d) + '%'; }
function fv(pv, r, n) { return pv * Math.pow(1 + r/100, n); }
function sipReq(fv2, annRet, months) {
  if (months <= 0 || fv2 <= 0) return 0;
  const r = annRet/100/12;
  if (r === 0) return fv2/months;
  return fv2 * r / ((Math.pow(1+r, months) - 1) * (1+r));
}
function toggleSI() { document.getElementById('sp_inc_f').style.display = document.getElementById('sp_work')?.value === 'yes' ? 'block' : 'none'; }
function calcIncome() {
  const t = nf('i_sal') + nf('i_rent') + nf('i_other') + (vf('sp_work')==='yes' ? nf('sp_inc') : 0);
  const b = document.getElementById('inc_box'); const d = document.getElementById('inc_disp');
  if (b && d && t > 0) { b.style.display='block'; d.textContent=fmt(t); }
}
function calcExp() {
  const t = nf('e_hh') + nf('e_edu') + nf('e_med') + nf('e_life') + nf('e_ins') + nf('e_oth');
  const b = document.getElementById('exp_box'); const d = document.getElementById('exp_disp');
  if (b && d && t > 0) { b.style.display='block'; d.textContent=fmt(t); }
}
function calcEmi() {
  const t = nf('l_hemi') + nf('l_pemi') + nf('l_cemi');
  const b = document.getElementById('emi_box'); const d = document.getElementById('emi_disp');
  if (b && d && t > 0) { b.style.display='block'; d.textContent=fmt(t); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDUCATION PLANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildEduPlanner() {
  const c = document.getElementById('edu_container');
  if (!c) return;
  c.innerHTML = '';
  [['c1n','c1d','Child 1'],['c2n','c2d','Child 2']].forEach((ch,ci) => {
    const name = formData[ch[0]] || ch[2];
    const currY = new Date().getFullYear();
    let rows = '';
    CLASS_LIST.forEach((cls, ri) => {
      const feeKey = `edu_${ci}_fee_${ri}`;
      const yrKey = `edu_${ci}_yr_${ri}`;
      const savedFee = formData[feeKey] || '';
      const savedYr = formData[yrKey] || (currY + ri);
      rows += `<tr>
        <td style="font-weight:600;white-space:nowrap">${cls}</td>
        <td><input type="number" id="${yrKey}" value="${savedYr}" style="width:70px" oninput="fd('${yrKey}',this.value);calcEduRow(${ci},${ri})"></td>
        <td><div style="position:relative"><span style="position:absolute;left:8px;top:50%;transform:translateY(-50%);color:var(--gold);font-size:11px;font-weight:600">â‚¹</span><input type="number" id="${feeKey}" value="${savedFee}" style="padding-left:20px" oninput="fd('${feeKey}',this.value);calcEduRow(${ci},${ri})"></div></td>
        <td id="edu_infl_${ci}_${ri}" style="color:var(--gold);font-family:'DM Mono',monospace;font-size:11.5px">â€”</td>
        <td id="edu_sip_${ci}_${ri}" style="color:var(--green);font-family:'DM Mono',monospace;font-size:11.5px">â€”</td>
        <td id="edu_red_${ci}_${ri}" style="color:var(--red);font-family:'DM Mono',monospace;font-size:11.5px">â€”</td>
      </tr>`;
    });
    c.innerHTML += `<div style="margin-bottom:24px">
      <div class="sub-heading"><span>ğŸ‘¦</span> ${name}'s Education Plan</div>
      <div style="overflow-x:auto"><table class="edu-table">
        <thead><tr><th>Class</th><th>Year</th><th>Today's Fee (â‚¹)</th><th>Inflation-Adj. Fee</th><th>Monthly SIP</th><th>Redemption</th></tr></thead>
        <tbody>${rows}</tbody>
        <tfoot><tr style="background:var(--gold-pale)">
          <td colspan="2" style="font-weight:700;padding:9px 11px;font-size:12.5px">TOTAL</td>
          <td id="edu_tot_today_${ci}" style="font-weight:700;font-family:'DM Mono',monospace;font-size:12px;padding:9px 11px">â‚¹0</td>
          <td id="edu_tot_infl_${ci}" style="font-weight:700;font-family:'DM Mono',monospace;font-size:12px;padding:9px 11px;color:#b8860b">â‚¹0</td>
          <td id="edu_tot_sip_${ci}" style="font-weight:700;font-family:'DM Mono',monospace;font-size:12px;padding:9px 11px;color:var(--green)">â‚¹0/mo</td>
          <td id="edu_tot_red_${ci}" style="font-weight:700;font-family:'DM Mono',monospace;font-size:12px;padding:9px 11px;color:var(--red)">â‚¹0</td>
        </tfoot>
      </table></div>
    </div>`;
    CLASS_LIST.forEach((_, ri) => calcEduRow(ci, ri));
  });
}

function calcEduRow(ci, ri) {
  const feeKey = `edu_${ci}_fee_${ri}`;
  const yrKey = `edu_${ci}_yr_${ri}`;
  const fee = parseFloat(formData[feeKey]) || 0;
  const yr = parseInt(formData[yrKey]) || (new Date().getFullYear() + ri);
  const infl = parseFloat(formData.edu_infl) || 10;
  const ret = parseFloat(formData.edu_ret) || 12;
  const yrs = Math.max(0, yr - new Date().getFullYear());
  const inflFee = fee > 0 ? fv(fee, infl, yrs) : 0;
  const sip = fee > 0 && yrs > 0 ? sipReq(inflFee, ret, yrs*12) : 0;
  const ie = (id) => document.getElementById(id);
  if (ie(`edu_infl_${ci}_${ri}`)) ie(`edu_infl_${ci}_${ri}`).textContent = fee > 0 ? fmt(inflFee) : 'â€”';
  if (ie(`edu_sip_${ci}_${ri}`)) ie(`edu_sip_${ci}_${ri}`).textContent = sip > 0 ? fmt(sip)+'/mo' : 'â€”';
  if (ie(`edu_red_${ci}_${ri}`)) ie(`edu_red_${ci}_${ri}`).textContent = fee > 0 ? fmt(inflFee) : 'â€”';
  // Update totals
  let totToday=0,totInfl=0,maxSip=0,totRed=0;
  CLASS_LIST.forEach((_,r2)=>{
    const f2=parseFloat(formData[`edu_${ci}_fee_${r2}`])||0;
    const y2=parseInt(formData[`edu_${ci}_yr_${r2}`])||(new Date().getFullYear()+r2);
    const yrs2=Math.max(0,y2-new Date().getFullYear());
    const if2=f2>0?fv(f2,infl,yrs2):0;
    const s2=f2>0&&yrs2>0?sipReq(if2,ret,yrs2*12):0;
    totToday+=f2;totInfl+=if2;maxSip=Math.max(maxSip,s2);totRed+=if2;
  });
  if (ie(`edu_tot_today_${ci}`)) ie(`edu_tot_today_${ci}`).textContent=fmt(totToday);
  if (ie(`edu_tot_infl_${ci}`)) ie(`edu_tot_infl_${ci}`).textContent=fmt(totInfl);
  if (ie(`edu_tot_sip_${ci}`)) ie(`edu_tot_sip_${ci}`).textContent=fmt(maxSip)+'/mo';
  if (ie(`edu_tot_red_${ci}`)) ie(`edu_tot_red_${ci}`).textContent=fmt(totRed);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PORTFOLIO ROWS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMFRow() {
  mfCount++;
  const id = mfCount;
  const catOpts = MF_CATS.map(c=>`<option>${c}</option>`).join('');
  const row = document.createElement('tr');
  row.id = `mf_row_${id}`;
  row.innerHTML = `<td><input type="text" id="mf_name_${id}" placeholder="Fund nameâ€¦"></td><td><select id="mf_cat_${id}">${catOpts}</select></td><td><input type="number" id="mf_inv_${id}" placeholder="0"></td><td><input type="number" id="mf_cur_${id}" placeholder="0"></td><td><input type="number" id="mf_sip_${id}" placeholder="0"></td><td><input type="number" id="mf_dur_${id}" placeholder="3"></td><td><input type="number" id="mf_xirr_${id}" placeholder="12" step="0.1"></td><td><button class="btn-del" onclick="document.getElementById('mf_row_${id}').remove()">âœ•</button></td>`;
  document.getElementById('mf_body').appendChild(row);
}
function addETFRow() {
  etfCount++;
  const id = etfCount;
  const typeOpts = ETF_TYPES.map(t=>`<option>${t}</option>`).join('');
  const row = document.createElement('tr');
  row.id = `etf_row_${id}`;
  row.innerHTML = `<td><input type="text" id="etf_name_${id}" placeholder="ETF nameâ€¦"></td><td><select id="etf_type_${id}">${typeOpts}</select></td><td><input type="number" id="etf_units_${id}" placeholder="0" oninput="calcEtfRow(${id})"></td><td><input type="number" id="etf_avg_${id}" placeholder="0" oninput="calcEtfRow(${id})"></td><td><input type="number" id="etf_cur_${id}" placeholder="0" oninput="calcEtfRow(${id})"></td><td id="etv_${id}" style="font-family:'DM Mono',monospace;font-size:12px">â‚¹0</td><td id="etg_${id}" style="font-family:'DM Mono',monospace;font-size:12px">0%</td><td><button class="btn-del" onclick="document.getElementById('etf_row_${id}').remove()">âœ•</button></td>`;
  document.getElementById('etf_body').appendChild(row);
}
function calcEtfRow(id) {
  const u=parseFloat(document.getElementById(`etf_units_${id}`)?.value)||0;
  const a=parseFloat(document.getElementById(`etf_avg_${id}`)?.value)||0;
  const c=parseFloat(document.getElementById(`etf_cur_${id}`)?.value)||0;
  const val=u*c; const inv=u*a; const gl=inv>0?((val-inv)/inv*100):0;
  const ve=document.getElementById(`etv_${id}`); const ge=document.getElementById(`etg_${id}`);
  if(ve)ve.textContent=fmt(val);
  if(ge){ge.textContent=(gl>=0?'+':'')+gl.toFixed(1)+'%';ge.style.color=gl>=0?'var(--green)':'var(--red)';}
}
function addStockRow() {
  stockCount++;
  const id = stockCount;
  const secOpts = SECTORS.map(s=>`<option>${s}</option>`).join('');
  const row = document.createElement('tr');
  row.id = `stock_row_${id}`;
  row.innerHTML = `<td><input type="text" id="st_name_${id}" placeholder="RELIANCEâ€¦"></td><td><select id="st_sec_${id}">${secOpts}</select></td><td><input type="number" id="st_qty_${id}" placeholder="10" oninput="calcStRow(${id})"></td><td><input type="number" id="st_avg_${id}" placeholder="0" oninput="calcStRow(${id})"></td><td><input type="number" id="st_cur_${id}" placeholder="0" oninput="calcStRow(${id})"></td><td id="sti_${id}" style="font-family:'DM Mono',monospace;font-size:12px">â‚¹0</td><td id="stv_${id}" style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600">â‚¹0</td><td id="stg_${id}" style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600">0%</td><td><button class="btn-del" onclick="document.getElementById('stock_row_${id}').remove()">âœ•</button></td>`;
  document.getElementById('stock_body').appendChild(row);
}
function calcStRow(id) {
  const q=parseFloat(document.getElementById(`st_qty_${id}`)?.value)||0;
  const a=parseFloat(document.getElementById(`st_avg_${id}`)?.value)||0;
  const c=parseFloat(document.getElementById(`st_cur_${id}`)?.value)||0;
  const inv=q*a; const val=q*c; const gl=inv>0?((val-inv)/inv*100):0;
  const ie=(i)=>document.getElementById(i);
  if(ie(`sti_${id}`))ie(`sti_${id}`).textContent=fmt(inv);
  if(ie(`stv_${id}`))ie(`stv_${id}`).textContent=fmt(val);
  if(ie(`stg_${id}`)){ie(`stg_${id}`).textContent=(gl>=0?'+':'')+gl.toFixed(1)+'%';ie(`stg_${id}`).style.color=gl>=0?'var(--green)':'var(--red)';}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REVIEW GRID
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildReviewGrid() {
  const items = [
    {l:'Name',v:vf('p_name')||'â€”'},
    {l:'Monthly Salary',v:fmt(nf('i_sal'))},
    {l:'Monthly Expenses',v:fmt(nf('e_hh')+nf('e_edu')+nf('e_med')+nf('e_life')+nf('e_ins')+nf('e_oth'))},
    {l:'Total EMI',v:fmt(nf('l_hemi')+nf('l_pemi')+nf('l_cemi'))},
    {l:'Life Insurance',v:fmt(nf('ins_sa'))},
    {l:'Health Insurance',v:fmt(nf('ins_hc'))},
    {l:'Total Corpus',v:fmt(nf('inv_tot')||nf('inv_mf')+nf('inv_epf')+nf('inv_fd'))},
    {l:'Emergency Fund',v:nf('r_efa')>0?fmt(nf('r_efa')):'âš ï¸ Not Available'},
    {l:'Risk Profile',v:vf('inv_risk')||'Not set'},
  ];
  const g = document.getElementById('review_grid');
  if (g) g.innerHTML = items.map(i=>`<div style="background:var(--section-bg);border:1px solid var(--border);border-left:3px solid var(--gold);border-radius:8px;padding:11px 14px"><div style="font-size:10px;text-transform:uppercase;letter-spacing:0.4px;color:var(--text-light);font-weight:600">${i.l}</div><div style="font-size:13.5px;font-weight:600;color:var(--navy);margin-top:3px">${i.v}</div></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORT GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REPORT PAYMENT GATE  â€” â‚¹199 per report via UPI
//  Admin is always exempt. Users pay once per day per email.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _pgTab = 'qr';   // active tab in payment modal

function generateAndShowReport() {
  capturePortfolioToFormData();
  saveFormData();
  // Admin always bypasses payment
  if (currentUser?.role === 'admin') { _runReport(); return; }
  // â”€â”€ PAYMENT GATE DISABLED â€” enable when ready â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Uncomment the 3 lines below to re-enable â‚¹199 gate:
  // if (ud.paidToken === _todayToken()) { _runReport(); return; }
  // _openPayGate();
  // return;
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  _runReport();
}

function _todayToken() {
  // Valid only for today â€” prevents yesterday's token reuse
  return 'paid_' + currentUser.email + '_' + new Date().toISOString().slice(0, 10);
}

// â”€â”€ Open payment modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function _openPayGate() {
  const m = document.getElementById('payGateModal');
  if (!m) { _runReport(); return; }   // fallback if modal missing
  m.style.display = 'flex';
  document.getElementById('pg-success').style.display = 'none';
  document.getElementById('pg-action-btn').style.display = 'block';
  document.getElementById('pg-action-btn').disabled = false;
  document.getElementById('pg-action-btn').textContent = "ğŸš€ I've Paid â€” Generate My Report";
  document.getElementById('pg-utr').value = '';
  // Build UPI deep-link
  const upiUrl = `upi://pay?pa=${encodeURIComponent(APP_CONFIG.UPI_ID)}&pn=${encodeURIComponent(APP_CONFIG.UPI_NAME)}&am=${APP_CONFIG.REPORT_PRICE}&cu=INR&tn=${encodeURIComponent('SFS Report - ' + (vf('p_name') || currentUser.name))}`;
  document.getElementById('pg-upi-show').textContent    = APP_CONFIG.UPI_ID;
  document.getElementById('pg-upi-id-text').textContent = APP_CONFIG.UPI_ID;
  // Generate QR
  _drawQR(upiUrl);
  _pgSwitchTab('qr');
}

function _drawQR(url) {
  const size = 200;
  const canvas = document.getElementById('qrCanvas');
  if (!canvas) return;
  // Use QRCode.js if loaded, else show placeholder text
  if (window.QRCode) {
    QRCode.toCanvas(canvas, url, { width: size, margin: 1, color: { dark: '#0a1628', light: '#ffffff' } });
  } else {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f8f5ee'; ctx.fillRect(0, 0, size, size);
    ctx.fillStyle = '#0a1628'; ctx.font = '13px DM Sans, sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('QR library loadingâ€¦', size/2, size/2 - 8);
    ctx.fillText('Use UPI ID tab instead', size/2, size/2 + 12);
  }
}

function closePayGate() { document.getElementById('payGateModal').style.display = 'none'; }

function _pgSwitchTab(tab) {
  _pgTab = tab;
  ['qr','upi','utr'].forEach(t => {
    const p  = document.getElementById('pg-panel-' + t);
    const tb = document.getElementById('pg-tab-'   + t);
    if (p)  p.style.display  = t === tab ? 'block' : 'none';
    if (tb) { tb.style.background = t === tab ? '#0a1628' : 'transparent'; tb.style.color = t === tab ? '#fff' : '#6b6b8a'; }
  });
  const btn = document.getElementById('pg-action-btn');
  btn.textContent = tab === 'utr' ? 'âœ… Verify UTR & Generate Report' : "ğŸš€ I've Paid â€” Enter UTR to Continue";
}

function pgCopyUPI() {
  navigator.clipboard?.writeText(APP_CONFIG.UPI_ID);
  const c = document.getElementById('pg-copy-confirm'); if (c) { c.style.display = 'block'; setTimeout(() => c.style.display = 'none', 2500); }
}

async function handlePayGate() {
  if (_pgTab !== 'utr') { _pgSwitchTab('utr'); document.getElementById('pg-utr').focus(); return; }
  const utr = document.getElementById('pg-utr').value.trim();
  if (!utr || utr.length < 8) { alert('Please enter a valid UTR / Transaction ID (min 8 characters).'); return; }
  const btn = document.getElementById('pg-action-btn');
  btn.disabled = true; btn.textContent = 'Recording paymentâ€¦';

  // Save payment locally
  const record = {
    email:    currentUser.email,
    name:     currentUser.name,
    mobile:   currentUser.mobile || vf('p_mobile') || '',
    utr,
    amount:   APP_CONFIG.REPORT_PRICE,
    upi_id:   APP_CONFIG.UPI_ID,
    plan:     currentUser.plan,
    registered: currentUser.registered,
    date:     new Date().toISOString(),
    status:   'pending_verification',
  };
  const payments = DB.getPayments(); payments.push(record); DB.savePayments(payments);

  // Mark today as paid
  const ud = DB.getUserData(currentUser.email);
  ud.paidToken   = _todayToken();
  ud.lastPayment = record;
  DB.saveUserData(currentUser.email, ud);

  // Push to Google Sheets
  await pushToSheets('REPORT_PAYMENT', record);

  // Show success then generate
  document.getElementById('pg-success').style.display = 'block';
  btn.style.display = 'none';
  setTimeout(() => { closePayGate(); _runReport(); }, 1600);
}

// â”€â”€ Actually generate the report (no gate) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function _runReport() {
  document.getElementById('loadingMsg').textContent = 'Generating your personalised financial reportâ€¦';
  document.getElementById('loadingOverlay').classList.add('show');
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.remove('show');
    const html = buildReportHTML();
    document.getElementById('reportContent').innerHTML = html;
    document.getElementById('rpt-client-name').textContent = vf('p_name') || 'Client';
    saveReportSummary();
    showScreen('screen-report');
  }, 1800);
}

function saveReportSummary() {
  const totalIncome = nf('i_sal') + nf('i_rent') + nf('i_other') + (vf('sp_work')==='yes' ? nf('sp_inc') : 0);
  const totalExp = nf('e_hh') + nf('e_edu') + nf('e_med') + nf('e_life') + nf('e_ins') + nf('e_oth');
  const totalEMI = nf('l_hemi') + nf('l_pemi') + nf('l_cemi');
  const surplus = totalIncome - totalExp - totalEMI;
  const corpus = nf('inv_tot') || nf('inv_mf') + nf('inv_epf') + nf('inv_fd');
  const emgMonths = (totalExp + totalEMI) > 0 ? nf('r_efa') / (totalExp + totalEMI) : 0;
  const annualIncome = nf('i_gross') || totalIncome * 12;
  const lifeSA = nf('ins_sa'); const healthCover = nf('ins_hc');
  const recLifeSA = annualIncome * 20;
  let score = 0;
  score += Math.min(20, (emgMonths/6)*20);
  score += Math.min(25, (lifeSA>=recLifeSA*0.5?10:(lifeSA/Math.max(recLifeSA,1))*10)+(healthCover>=500000?15:(healthCover/500000)*15));
  const debtR = totalIncome>0?(totalEMI/totalIncome)*100:0;
  score += debtR<=30?20:debtR<=50?10:0;
  score += Math.min(20, totalIncome>0?((surplus/totalIncome)/0.2)*20:0);
  score += Math.min(15, (nf('inv_sip')>0?8:0)+(corpus>0?5:0)+(vf('inv_gm')==='yes'?2:0));
  const finalScore = Math.min(100, Math.round(score));
  const ud = DB.getUserData(currentUser.email);
  ud.lastReport = { score: finalScore, surplus, corpus, insStatus: (lifeSA>0&&healthCover>0)?'âœ… Covered':'âš ï¸ Gap', emgMonths };
  const history = ud.history || [];
  history.push({ date: new Date().toISOString(), score: finalScore });
  ud.history = history.slice(-10);
  DB.saveUserData(currentUser.email, ud);
  const users = DB.getUsers();
  users[currentUser.email].assessments = history.length;
  users[currentUser.email].score = finalScore;
  DB.saveUsers(users);

  // â”€â”€ Push full assessment snapshot to Google Sheets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  pushToSheets('ASSESSMENT', {
    // Identity
    name:              vf('p_name') || currentUser.name,
    email:             currentUser.email,
    mobile:            vf('p_mobile') || currentUser.mobile || '',
    dob:               vf('p_dob')   || '',
    plan:              currentUser.plan,
    // Income
    monthly_salary:    nf('i_sal'),
    rental_income:     nf('i_rent'),
    other_income:      nf('i_other'),
    annual_gross:      nf('i_gross'),
    spouse_income:     vf('sp_work')==='yes' ? nf('sp_inc') : 0,
    total_income:      totalIncome,
    // Expenses
    household_exp:     nf('e_hh'),
    edu_exp:           nf('e_edu'),
    medical_exp:       nf('e_med'),
    lifestyle_exp:     nf('e_life'),
    insurance_prem:    nf('e_ins'),
    other_exp:         nf('e_oth'),
    total_expenses:    totalExp,
    // Loans
    home_loan_bal:     nf('l_hbal'),
    home_emi:          nf('l_hemi'),
    personal_loan:     nf('l_pbal'),
    personal_emi:      nf('l_pemi'),
    car_loan:          nf('l_cbal'),
    car_emi:           nf('l_cemi'),
    total_emi:         totalEMI,
    // Insurance
    life_sa:           lifeSA,
    health_cover:      healthCover,
    term_insurance:    vf('term_ins'),
    // Investments
    emergency_fund:    nf('r_efa'),
    mf_corpus:         nf('inv_mf'),
    epf_ppf:           nf('inv_epf'),
    fd_corpus:         nf('inv_fd'),
    total_corpus:      corpus,
    monthly_sip:       nf('inv_sip'),
    risk_profile:      vf('inv_risk'),
    // Computed
    monthly_surplus:   surplus,
    debt_ratio_pct:    +debtR.toFixed(1),
    emg_months:        +emgMonths.toFixed(1),
    health_score:      finalScore,
    assessment_count:  history.length,
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORT HTML BUILDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildReportHTML() {
  const name = vf('p_name') || 'Valued Client';
  const totalIncome = nf('i_sal') + nf('i_rent') + nf('i_other') + (vf('sp_work')==='yes' ? nf('sp_inc') : 0);
  const annualIncome = nf('i_gross') || totalIncome * 12;
  const totalExp = nf('e_hh') + nf('e_edu') + nf('e_med') + nf('e_life') + nf('e_ins') + nf('e_oth');
  const totalEMI = nf('l_hemi') + nf('l_pemi') + nf('l_cemi');
  const surplus = totalIncome - totalExp - totalEMI;
  const debtR = totalIncome>0?(totalEMI/totalIncome)*100:0;
  const savR = totalIncome>0?(surplus/totalIncome)*100:0;
  const lifeSA = nf('ins_sa'); const healthCover = nf('ins_hc');
  const corpus = nf('inv_tot') || nf('inv_mf') + nf('inv_epf') + nf('inv_fd');
  const emgFund = nf('r_efa');
  const emgMonths = (totalExp+totalEMI)>0 ? emgFund/(totalExp+totalEMI) : 0;
  const sipAmt = nf('inv_sip');
  const recLifeSA = annualIncome * 20;
  const inflation = nf('g_infl') || 6;
  const retRate = nf('g_ret') || 12;
  const currY = new Date().getFullYear();

  // SCORE
  let score = 0;
  const sbars = [];
  const addS = (l,g,m)=>{score+=g;sbars.push({l,g:Math.round(g),m,p:(g/m)*100});};
  addS('Emergency Fund',Math.min(20,(emgMonths/6)*20),20);
  const is=(lifeSA>=recLifeSA*0.5?10:(lifeSA/Math.max(recLifeSA,1))*10)+(healthCover>=500000?15:(healthCover/500000)*15);
  addS('Insurance',Math.min(25,is),25);
  addS('Debt Management',debtR<=30?20:debtR<=50?10:0,20);
  addS('Savings Rate',Math.min(20,totalIncome>0?(surplus/totalIncome)/0.2*20:0),20);
  addS('Investments',Math.min(15,(sipAmt>0?8:0)+(corpus>0?5:0)+(vf('inv_gm')==='yes'?2:0)),15);
  const finalScore = Math.min(100,Math.round(score));
  const scoreLabel = finalScore>=75?'Excellent Financial Health':finalScore>=55?'Good â€“ Scope for Improvement':finalScore>=35?'Needs Attention':'Critical â€“ Immediate Action Required';
  const cfn = p=>p>=70?'bg':p>=40?'bw':'bd';

  // PORTFOLIO CALCS
  let mfInv=0,mfCur=0,etfInv=0,etfCur=0,stInv=0,stCur=0;
  const mfs=formData._mfs||[]; const etfs=formData._etfs||[]; const stocks=formData._stocks||[];
  mfs.forEach(m=>{mfInv+=parseFloat(m.inv)||0;mfCur+=parseFloat(m.cur)||0;});
  etfs.forEach(e=>{const u=parseFloat(e.units)||0;etfInv+=u*(parseFloat(e.avg)||0);etfCur+=u*(parseFloat(e.cur)||0);});
  stocks.forEach(s=>{const q=parseFloat(s.qty)||0;stInv+=q*(parseFloat(s.avg)||0);stCur+=q*(parseFloat(s.cur)||0);});

  // REMARKS
  function getMFRem(cat,xirr){const x=parseFloat(xirr)||0;if(cat==='Index Fund')return{rec:'Buy / SIP â†‘',css:'pbuy',r:'Excellent core holding. Low cost. Increase SIP â€” should form 40â€“50% of equity allocation.'};if(cat==='Large Cap')return x<10?{rec:'Review',css:'prev',r:'Underperforming. Consider switching to Nifty 100 Index Fund.'}:{rec:'Hold',css:'phold',r:'Decent large cap performance. Benchmark against Nifty 100.'};if(cat==='Small Cap')return x>=18?{rec:'Partial Book',css:'psell',r:'Exceptional returns. Book 25â€“30% profits if held >3 years (LTCG benefit).'}:{rec:'Hold',css:'phold',r:'Good returns. Ensure 5+ year horizon. Do not panic-sell during corrections.'};if(cat==='ELSS')return{rec:'Hold',css:'phold',r:'Tax-saving under 80C. Hold till 3-year lock-in. Evaluate vs Flexi Cap peers after.'};if(cat==='Debt / Liquid')return x<5?{rec:'Review',css:'prev',r:'Returns below FD rates. Consider short-duration fund.'}:{rec:'Hold',css:'phold',r:'Suitable for emergency/short-term goals. Keep max 20â€“25% allocation.'};return x<8?{rec:'Review',css:'prev',r:'Underperforming. Compare with category average and consider switching.'}:{rec:'Hold',css:'phold',r:'Average performance. Monitor for 2 more quarters.'};}
  function getETFRem(type,gl){if(type.includes('Nifty 50')||type.includes('Sensex'))return gl>=0?{rec:'Hold / SIP â†‘',css:'phold',r:'Core holding. Nifty 50 CAGR ~12â€“13% historically. Keep increasing via SIP.'}:{rec:'Buy More',css:'pbuy',r:'Market dip = opportunity for index ETF. Buy more via STP.'};if(type.includes('Gold'))return{rec:'Hold',css:'phold',r:'Hedge against inflation. Keep 5â€“10% of portfolio. SGB may offer better returns long-term.'};if(type.includes('Banking')||type.includes('PSU'))return gl>=15?{rec:'Partial Book',css:'psell',r:'Sector ETF has good gains. Book 20â€“30% profits â€” sectoral ETFs are cyclical.'}:{rec:'Hold',css:'phold',r:'Sectoral ETF â€” limit to 10â€“15% of equity. Monitor sector news.'};return gl>=10?{rec:'Hold',css:'phold',r:'Decent returns. Review annually.'}:{rec:'Review',css:'prev',r:'Evaluate if this ETF fits your strategy.'};};
  function getStRem(gl){if(gl<=-30)return{rec:'Review / Exit',css:'psell',r:'Heavy loss. Evaluate if thesis is intact. If not, exit and use for tax harvesting.'};if(gl>=100)return{rec:'Partial Book',css:'psell',r:'Excellent returns. Book 25â€“30% profits if held >1 year (LTCG â‚¹1L tax-free). Let rest compound.'};if(gl>=30)return{rec:'Hold',css:'phold',r:'Strong gain. Hold with trailing stop-loss. Review quarterly results.'};if(gl>=0)return{rec:'Hold / Accum.',css:'phold',r:'Moderate gain. Accumulate on dips if fundamentals strong.'};if(gl>=-20)return{rec:'Review',css:'prev',r:'Minor loss. Review fundamentals and management commentary.'};return{rec:'Hold',css:'phold',r:'Evaluate based on latest results. Maintain discipline.'};};

  const mfRows = mfs.filter(m=>m.name).map(m=>{const inv=parseFloat(m.inv)||0;const cur=parseFloat(m.cur)||0;const gl=inv>0?((cur-inv)/inv*100):0;const{rec,css,r}=getMFRem(m.cat,m.xirr);return`<tr><td><strong>${m.name}</strong></td><td style="font-size:11px">${m.cat}</td><td style="font-family:'DM Mono',monospace">${fmt(inv)}</td><td style="font-family:'DM Mono',monospace">${fmt(cur)}</td><td style="color:${gl>=0?'var(--green)':'var(--red)'};font-weight:600">${gl>=0?'+':''}${gl.toFixed(1)}%</td><td style="font-family:'DM Mono',monospace">${m.xirr||'â€”'}%</td><td><span class="port-badge ${css}">${rec}</span></td><td style="font-size:11px;color:var(--text-mid);max-width:180px">${r}</td></tr>`;}).join('');
  const etfRows = etfs.filter(e=>e.name).map(e=>{const u=parseFloat(e.units)||0;const inv=u*(parseFloat(e.avg)||0);const val=u*(parseFloat(e.cur)||0);const gl=inv>0?((val-inv)/inv*100):0;const{rec,css,r}=getETFRem(e.type,gl);return`<tr><td><strong>${e.name}</strong></td><td style="font-size:11px">${e.type}</td><td>${e.units}</td><td style="font-family:'DM Mono',monospace">${fmt(parseFloat(e.avg)||0)}</td><td style="font-family:'DM Mono',monospace">${fmt(parseFloat(e.cur)||0)}</td><td style="font-family:'DM Mono',monospace">${fmt(val)}</td><td style="color:${gl>=0?'var(--green)':'var(--red)'};font-weight:600">${gl>=0?'+':''}${gl.toFixed(1)}%</td><td><span class="port-badge ${css}">${rec}</span></td><td style="font-size:11px;color:var(--text-mid);max-width:180px">${r}</td></tr>`;}).join('');
  const stRows = stocks.filter(s=>s.name).map(s=>{const q=parseFloat(s.qty)||0;const inv=q*(parseFloat(s.avg)||0);const val=q*(parseFloat(s.cur)||0);const gl=inv>0?((val-inv)/inv*100):0;const{rec,css,r}=getStRem(gl);return`<tr><td><strong>${s.name}</strong></td><td style="font-size:11px">${s.sec}</td><td>${s.qty}</td><td style="font-family:'DM Mono',monospace">${fmt(parseFloat(s.avg)||0)}</td><td style="font-family:'DM Mono',monospace">${fmt(parseFloat(s.cur)||0)}</td><td style="font-family:'DM Mono',monospace">${fmt(inv)}</td><td style="font-family:'DM Mono',monospace">${fmt(val)}</td><td style="color:${gl>=0?'var(--green)':'var(--red)'};font-weight:600">${gl>=0?'+':''}${gl.toFixed(1)}%</td><td><span class="port-badge ${css}">${rec}</span></td><td style="font-size:11px;color:var(--text-mid);max-width:160px">${r}</td></tr>`;}).join('');

  // EDUCATION ROWS
  let eduHTML = '';
  [0,1].forEach(ci=>{
    const chName = formData[`c${ci+1}n`];
    if(!chName) return;
    let rows=''; let hasData=false;
    let totToday=0,totInfl=0,maxSip=0,totRed=0;
    CLASS_LIST.forEach((cls,ri)=>{
      const fee=parseFloat(formData[`edu_${ci}_fee_${ri}`])||0;
      if(!fee)return;
      hasData=true;
      const yr=parseInt(formData[`edu_${ci}_yr_${ri}`])||(currY+ri);
      const yrs=Math.max(0,yr-currY);
      const infl=parseFloat(formData.edu_infl)||10;
      const ret=parseFloat(formData.edu_ret)||12;
      const iF=fv(fee,infl,yrs);
      const sip=yrs>0?sipReq(iF,ret,yrs*12):0;
      totToday+=fee;totInfl+=iF;maxSip=Math.max(maxSip,sip);totRed+=iF;
      const fundType=yrs===0?'Liquid Fund':yrs<=2?'Short Duration Debt':yrs<=5?'Hybrid Fund':'Equity MF';
      rows+=`<tr><td style="font-weight:600">${cls}</td><td>${yr}</td><td style="font-family:'DM Mono',monospace">${fmt(fee)}</td><td style="font-family:'DM Mono',monospace;color:var(--gold);font-weight:600">${fmt(iF)}</td><td style="font-family:'DM Mono',monospace;color:var(--green);font-weight:600">${sip>0?fmt(sip)+'/mo':'â€”'}</td><td style="font-family:'DM Mono',monospace;color:var(--red);font-weight:600">${fmt(iF)}</td><td style="font-size:11px;color:var(--text-light)">${fundType}</td></tr>`;
    });
    if(!hasData)return;
    eduHTML+=`<div style="margin-bottom:24px"><div style="font-family:'Playfair Display',serif;font-size:15px;color:var(--navy);margin-bottom:12px;font-weight:600">ğŸ‘¦ ${chName}'s Education Plan</div><div style="overflow-x:auto"><table class="edu-rpt-table"><thead><tr><th>Class</th><th>Year</th><th>Today's Fee</th><th>Inflation-Adj Fee</th><th>Monthly SIP</th><th>Redemption</th><th>Recommended Fund</th></tr></thead><tbody>${rows}</tbody><tfoot><tr style="background:var(--gold-pale)"><td colspan="2" style="font-weight:700;padding:9px 11px">TOTAL</td><td style="font-weight:700;font-family:'DM Mono',monospace;padding:9px 11px">${fmt(totToday)}</td><td style="font-weight:700;font-family:'DM Mono',monospace;padding:9px 11px;color:#b8860b">${fmt(totInfl)}</td><td style="font-weight:700;font-family:'DM Mono',monospace;padding:9px 11px;color:var(--green)">Max SIP: ${fmt(maxSip)}/mo</td><td style="font-weight:700;font-family:'DM Mono',monospace;padding:9px 11px;color:var(--red)">${fmt(totRed)}</td><td></td></tfoot></table></div><div style="background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:11px 14px;margin-top:10px;font-size:12px;color:#1b5e20">ğŸ“Œ Start a dedicated SIP of <strong>${fmt(maxSip)}/month</strong> for ${chName}. Redeem only the amount needed each year at fee time. Remaining corpus continues to compound. Increase SIP by 10% each year.</div></div>`;
  });

  // GOALS
  let goalRows = '';
  for(let i=1;i<=5;i++){
    const gc=parseFloat(formData[`g${i}c`])||0;const gy=parseInt(formData[`g${i}y`])||0;if(!gc||!gy)continue;
    const yrs=Math.max(1,gy-currY);const fc=fv(gc,inflation,yrs);const sip=sipReq(fc,retRate,yrs*12);
    goalRows+=`<div class="goal-proj-row"><div style="font-weight:600;font-size:12.5px">${formData[`g${i}n`]||`Goal ${i}`}</div><div style="font-size:11.5px;color:var(--text-light)">${gy} (${yrs}yr)</div><div style="font-family:'DM Mono',monospace;font-size:12.5px">${fmt(gc)}</div><div style="font-family:'DM Mono',monospace;font-size:12.5px;color:var(--gold);font-weight:600">${fmt(fc)}</div><div style="font-family:'DM Mono',monospace;font-size:12.5px;color:var(--green);font-weight:600">${fmt(sip)}/mo</div></div>`;
  }

  // SUGGESTIONS
  const termIn = document.querySelector('input[name="term_ins"]:checked')?.value === 'yes' || formData.term_ins === 'yes';
  const sugs = [];
  if(!termIn) sugs.push({p:'sh',b:'ğŸš¨ URGENT',t:'Buy Term Insurance Today',d:`Your family has NO life cover. Get ${fmt(recLifeSA)} cover â€” top picks: HDFC Life Click2Protect Super, ICICI iProtect Smart, Max Life Smart Secure Plus. Cost: ~â‚¹8,000â€“15,000/yr.`});
  if(healthCover<1000000) sugs.push({p:'sh',b:'ğŸš¨ URGENT',t:'Upgrade Health Insurance',d:`Current ${fmt(healthCover)} is too low. Buy â‚¹20L family floater (Niva Bupa ReAssure 2.0, Care Supreme) + â‚¹50L super top-up for complete protection.`});
  if(emgMonths<3) sugs.push({p:'sh',b:'ğŸš¨ HIGH',t:'Build Emergency Fund',d:`Only ${emgMonths.toFixed(1)} months covered. Build ${fmt((totalExp+totalEMI)*6)} in a liquid fund before investing anywhere else.`});
  if(debtR>40) sugs.push({p:'sm',b:'âš ï¸ HIGH',t:'Reduce EMI Burden',d:`EMI ratio is ${pct(debtR)}, above 30% threshold. Prepay highest-interest loan first. Use surplus for partial prepayments.`});
  if(sipAmt<totalIncome*0.15) sugs.push({p:'sm',b:'âš ï¸ MEDIUM',t:'Increase Monthly SIP',d:`Increase SIP to ${fmt(totalIncome*0.20)}/month (20% of income). Use 10% annual step-up strategy.`});
  if(vf('ins_ci')!=='yes') sugs.push({p:'sm',b:'âš ï¸ MEDIUM',t:'Add Critical Illness Cover',d:`Buy â‚¹25â€“50L CI plan (ICICI Heart & Cancer Care, Max Life CI Rider). ~â‚¹6,000â€“12,000/yr.`});
  if(vf('r_will')!=='yes') sugs.push({p:'sm',b:'âš ï¸ MEDIUM',t:'Create Will & Update Nominees',d:`Create a registered will (~â‚¹3,000â€“5,000). Update nominees in all MF folios, EPF, PPF, bank accounts.`});
  sugs.push({p:'sl',b:'âœ… TAX',t:'Maximise Tax Savings',d:`Claim â‚¹1.5L under 80C (ELSS), â‚¹25,000 under 80D (health), â‚¹50,000 under 80CCD(1B) for NPS. Save up to â‚¹75,000+/year.`});
  sugs.push({p:'sl',b:'âœ… GROWTH',t:'Diversify Portfolio',d:`${vf('inv_risk')||'Moderate'} profile: 60% equity (Index + Flexi Cap), 25% debt (EPF + liquid), 10% gold (SGB/ETF), 5% international. Rebalance annually.`});
  sugs.push({p:'si',b:'ğŸ“Š PORTFOLIO',t:'Annual Portfolio Review',d:`Benchmark all MFs against category index. Any fund underperforming for 3+ years should be switched. Avoid over-diversification â€” 5â€“6 focused funds beat 20-fund portfolios.`});

  // ACTIONS
  const actions = [
    [1,'Buy Term Life Insurance','Insurance','ğŸš¨ Critical','30 days','Family security'],
    [2,'Upgrade Health Insurance to â‚¹20L+','Insurance','ğŸš¨ Critical','45 days','Medical protection'],
    [3,'Build Emergency Fund (6 months)','Emergency','ğŸš¨ High','3â€“6 months','Financial resilience'],
    [4,'Review MF Portfolio vs Benchmarks','Portfolio â€“ MF','âš ï¸ High','This month','Optimise returns'],
    [5,'Add CI & Personal Accident Cover','Insurance','âš ï¸ High','60 days','Catastrophic protection'],
    [6,`Increase SIP to ${fmt(totalIncome*0.20)}/month`,'Investments','ğŸ“ˆ Medium','This month','Wealth creation'],
    [7,'Review ETF Portfolio for Rebalancing','Portfolio â€“ ETF','ğŸ“ˆ Medium','1 month','Balance allocation'],
    [8,'Review Stock Portfolio â€“ Book Profits / Cut Losses','Portfolio â€“ Stocks','ğŸ“ˆ Medium','2 weeks','Risk management'],
    [9,'Create Will & Update All Nominees','Estate','ğŸ“‹ Medium','3â€“6 months','Estate protection'],
    [10,'Map Goals to Dedicated SIPs (incl. Education)','Planning','ğŸ“ˆ Medium','1â€“2 months','Goal-aligned investing'],
    [11,'Maximise 80C / 80D / 80CCD Tax Benefits','Tax','ğŸ’° Low','Before March 31','â‚¹75,000+ tax saving'],
    [12,'Annual Financial Review','Ongoing','ğŸ”„ Ongoing','Every 12 months','Stay on track'],
  ];

  return `
<div class="rpt-header">
  <div class="rpt-logo"><div class="ico">SF</div><div class="lt"><h1>Sekhar Financial Services</h1><p>Trusted Financial Planning Partners</p></div></div>
  <div class="rpt-title"><h2>Comprehensive Financial Planning Report</h2><p>Confidential â€” Prepared for <strong style="color:var(--gold-light)">${name}</strong></p></div>
  <div class="rpt-meta">
    <div class="rpt-meta-item"><div class="ml">Report Date</div><div class="mv">${new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'long',year:'numeric'})}</div></div>
    <div class="rpt-meta-item"><div class="ml">Prepared By</div><div class="mv">Sekhar Financial Services</div></div>
    <div class="rpt-meta-item"><div class="ml">Health Score</div><div class="mv" style="font-size:18px;font-weight:700">${finalScore}/100</div></div>
    <div class="rpt-meta-item"><div class="ml">Plan</div><div class="mv">${currentUser?.plan?.toUpperCase() || 'FREE'}</div></div>
  </div>
</div>
<div class="rpt-body">
<div class="sebi-disc">âš ï¸ <strong>IMPORTANT DISCLAIMER:</strong> Sekhar Financial Services is <strong>NOT a SEBI Registered Investment Adviser (RIA)</strong>. This report is for educational and general awareness purposes only. It does not constitute regulated financial or investment advice. All projections are indicative. Insurance product names are for general reference only. Consult a SEBI-registered adviser before making investment decisions. Premiums and product features vary â€” verify with insurers directly.</div>

<div class="score-banner">
  <div class="score-circ"><div class="sn">${finalScore}</div><div class="sm">/100</div></div>
  <div class="score-info"><h3>${scoreLabel}</h3><p>${finalScore>=75?'Strong foundations. Focus on growing wealth.':finalScore>=55?'Solid base with key gaps to bridge.':'Several areas need immediate attention.'}</p></div>
  <div class="score-bars">${sbars.map(b=>`<div class="sbi"><div class="bl">${b.l}</div><div class="bt"><div class="bf ${cfn(b.p)}" style="width:${b.p}%"></div></div><div class="bv">${b.g}/${b.m}</div></div>`).join('')}</div>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ“Š Key Financial Metrics</div>
  <div class="kpi-row">
    ${[
      {l:'Monthly Surplus',v:fmt(surplus),s:surplus>=0?'After expenses & EMIs':'âš ï¸ Deficit!',c:surplus>=0?'cgreen':'cred'},
      {l:'Debt-to-Income',v:pct(debtR),s:debtR<=30?'âœ… Healthy':'âš ï¸ High',c:debtR<=30?'cgreen':'cred'},
      {l:'Savings Rate',v:pct(savR),s:savR>=20?'âœ… Good':'âš ï¸ Low',c:savR>=20?'cgreen':'cred'},
      {l:'Emergency Fund',v:emgMonths.toFixed(1)+' mo',s:emgMonths>=6?'âœ… Adequate':'âš ï¸ Low',c:emgMonths>=6?'cgreen':'cred'},
      {l:'Life Cover',v:fmt(lifeSA),s:`Rec: ${fmt(recLifeSA)}`,c:lifeSA>=recLifeSA*0.8?'cgreen':'cred'},
      {l:'Health Cover',v:fmt(healthCover),s:healthCover>=1000000?'âœ… Basic OK':'âš ï¸ Low',c:healthCover>=1000000?'cgreen':'cred'},
      {l:'Total Corpus',v:fmt(corpus),s:'All investments',c:'cgold'},
      {l:'Monthly SIP',v:fmt(sipAmt),s:'Current SIP',c:'cblue'},
    ].map(k=>`<div class="kpi-c ${k.c}"><div class="kl">${k.l}</div><div class="kv">${k.v}</div><div class="ks">${k.s}</div></div>`).join('')}
  </div>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ” Financial Analysis</div>
  <table class="rpt-table"><thead><tr><th>Category</th><th>Current</th><th>Benchmark</th><th>Position</th><th>Status</th></tr></thead><tbody>
    ${[
      {cat:'Income vs Expenses',cur:`${fmt(totalIncome)} in | ${fmt(totalExp)} out`,bench:'Exp < 60% of income',pos:totalIncome>0?pct(totalExp/totalIncome*100)+' of income':'â€”',st:totalIncome>0&&totalExp/totalIncome<0.6?'sok':'swarn',stl:totalIncome>0&&totalExp/totalIncome<0.6?'âœ… Good':'âš ï¸ High'},
      {cat:'EMI Burden',cur:fmt(totalEMI)+'/mo',bench:'EMI < 30% income',pos:pct(debtR)+' of income',st:debtR<=30?'sok':debtR<=50?'swarn':'sbad',stl:debtR<=30?'âœ… Healthy':debtR<=50?'âš ï¸ High':'ğŸš¨ Danger'},
      {cat:'Emergency Fund',cur:fmt(emgFund),bench:'6 months exp+EMI',pos:emgMonths.toFixed(1)+' months',st:emgMonths>=6?'sok':emgMonths>=3?'swarn':'sbad',stl:emgMonths>=6?'âœ… OK':emgMonths>=3?'âš ï¸ Partial':'ğŸš¨ Critical'},
      {cat:'Life Insurance',cur:fmt(lifeSA),bench:'20Ã— Annual = '+fmt(recLifeSA),pos:lifeSA>0?(lifeSA/Math.max(annualIncome,1)).toFixed(1)+'Ã— income':'None',st:lifeSA>=recLifeSA*0.8?'sok':lifeSA>=recLifeSA*0.4?'swarn':'sbad',stl:lifeSA>=recLifeSA*0.8?'âœ… OK':lifeSA>=recLifeSA*0.4?'âš ï¸ Low':'ğŸš¨ Critical'},
      {cat:'Health Insurance',cur:fmt(healthCover),bench:'Min â‚¹20â€“50L family',pos:healthCover>=2000000?'Good':healthCover>=500000?'Basic':'Insufficient',st:healthCover>=2000000?'sok':healthCover>=500000?'swarn':'sbad',stl:healthCover>=2000000?'âœ… Good':'âš ï¸ Upgrade'},
      {cat:'Savings & Investment',cur:fmt(sipAmt)+'/mo SIP',bench:'â‰¥20% of income',pos:pct(savR),st:savR>=20?'sok':savR>=10?'swarn':'sbad',stl:savR>=20?'âœ… Excellent':savR>=10?'âš ï¸ Moderate':'ğŸš¨ Too Low'},
    ].map(r=>`<tr><td><strong>${r.cat}</strong></td><td>${r.cur}</td><td style="font-size:11px;color:var(--text-light)">${r.bench}</td><td>${r.pos}</td><td class="${r.st}">${r.stl}</td></tr>`).join('')}
  </tbody></table>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ›¡ï¸ Insurance Gap Analysis</div>
  <table class="rpt-table"><thead><tr><th>Type</th><th>Current</th><th>Recommended</th><th>Gap</th><th>Action</th></tr></thead><tbody>
    <tr><td><strong>Term Life</strong></td><td>${termIn?fmt(lifeSA):'Not in place'}</td><td>${fmt(recLifeSA)}</td><td>${!termIn||lifeSA<recLifeSA*0.8?fmt(Math.max(0,recLifeSA-lifeSA)):'None'}</td><td>${!termIn?'ğŸš¨ Buy term plan immediately':lifeSA<recLifeSA*0.8?'âš ï¸ Top up':'âœ… Adequate'}</td></tr>
    <tr><td><strong>Health (Family Floater)</strong></td><td>${fmt(healthCover)}</td><td>â‚¹20â€“50 Lakhs</td><td>${healthCover<2000000?fmt(2000000-healthCover):'None'}</td><td>${healthCover<1000000?'ğŸš¨ Urgent':healthCover<2000000?'âš ï¸ Upgrade':'âœ… OK'}</td></tr>
    <tr><td><strong>Super Top-Up</strong></td><td>${vf('ins_tu')==='yes'?'In place':'Missing'}</td><td>â‚¹50Lâ€“â‚¹1Cr</td><td>${vf('ins_tu')!=='yes'?'Missing':'None'}</td><td>${vf('ins_tu')!=='yes'?'âš ï¸ Add super top-up':'âœ… In place'}</td></tr>
    <tr><td><strong>Critical Illness</strong></td><td>${vf('ins_ci')==='yes'?'In place':'Not covered'}</td><td>â‚¹25â€“50 Lakhs</td><td>${vf('ins_ci')!=='yes'?'No coverage':'None'}</td><td>${vf('ins_ci')!=='yes'?'âš ï¸ Buy CI plan':'âœ… Covered'}</td></tr>
    <tr><td><strong>Personal Accident</strong></td><td>${vf('ins_pa')==='yes'?'In place':'Not covered'}</td><td>10Ã— Annual Income</td><td>${vf('ins_pa')!=='yes'?'No coverage':'None'}</td><td>${vf('ins_pa')!=='yes'?'âš ï¸ Buy PA policy':'âœ… Covered'}</td></tr>
  </tbody></table>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ† Recommended Insurance Products</div>
  <div class="warn-box" style="font-size:11px">âš ï¸ General reference only. Not SEBI/IRDAI advice. Verify premiums, terms, and suitability directly with insurers before purchasing.</div>
  ${[
    {t:'ğŸ”µ Best Term Life Plans',p:['HDFC Life Click2Protect Super','ICICI iProtect Smart','Max Life Smart Secure Plus','Tata AIA Sampoorna Raksha','LIC Tech Term (E-Term)','Bajaj Allianz eTouch Term'],n:'For â‚¹1Cr cover (~35 yrs, non-smoker): â‚¹8,000â€“18,000/year. Buy online â€” 30â€“40% cheaper than offline. Choose plans with disability waiver and terminal illness benefit.'},
    {t:'ğŸŸ¢ Best Health Insurance Plans',p:['Niva Bupa ReAssure 2.0','Care Supreme (Care Health)','HDFC Ergo Optima Secure','Aditya Birla Activ Assure Diamond','Star Health Family Optima','ManipalCigna ProHealth Prime'],n:'Recommended: â‚¹10â€“15L family floater + â‚¹50L super top-up. Look for: no-claim bonus, restoration benefit, cashless hospitals, no room rent capping.'},
    {t:'ğŸŸ¡ Critical Illness Plans',p:['ICICI Prudential Heart & Cancer Care','Star Critical Illness Multipay','Max Life CI & Disability Rider','Bajaj Allianz Critical Illness','Edelweiss Zindagi Plus CI','HDFC Life Cancer Care'],n:'â‚¹25â€“50L CI cover costs â‚¹4,000â€“12,000/year. Can add as rider to term plan at lower cost. Tax-deductible under Section 80D.'},
    {t:'ğŸ”´ Personal Accident Insurance',p:['Bajaj Allianz Personal Guard','HDFC Ergo Accident Guard','New India PA Policy','National Insurance PA','Oriental Insurance PA','Reliance General Accident Care'],n:'â‚¹50Lâ€“â‚¹1Cr PA policy = â‚¹2,000â€“5,000/year. Must-have if you have a home loan. Covers accidental death, PTD, PPD, and TTD.'},
  ].map(r=>`<div class="ins-rec-card"><h4>${r.t}</h4><div class="ppills">${r.p.map(p=>`<span class="ppill">${p}</span>`).join('')}</div><p style="margin-top:9px;font-size:11.5px;color:var(--text-light);border-top:1px solid var(--border);padding-top:8px">ğŸ’¡ ${r.n}</p></div>`).join('')}
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ¯ Goal Projections & SIP Requirements</div>
  <div style="display:grid;grid-template-columns:1.8fr 0.7fr 1.1fr 1.2fr 1.2fr;font-size:10px;font-weight:700;color:var(--text-light);text-transform:uppercase;letter-spacing:0.4px;padding:6px 0;border-bottom:2px solid var(--border)">
    <div>Goal</div><div>Target Yr</div><div>Today's Cost</div><div>Future Cost</div><div>Monthly SIP</div>
  </div>
  ${goalRows||'<p style="color:var(--text-light);font-size:12.5px;padding:14px 0">No goals defined.</p>'}
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ“ Child Education â€“ Year-wise Fee & SIP Plan</div>
  ${eduHTML||'<p style="color:var(--text-light);font-size:12.5px">No education data entered.</p>'}
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ›ï¸ Mutual Fund Portfolio Review</div>
  <div style="overflow-x:auto"><table class="rpt-table"><thead><tr><th>Fund Name</th><th>Category</th><th>Invested</th><th>Current</th><th>Gain/Loss</th><th>XIRR</th><th>Recommendation</th><th>Remarks</th></tr></thead><tbody>
    ${mfRows||'<tr><td colspan="8" style="color:var(--text-light);padding:14px">No mutual funds entered.</td></tr>'}
  </tbody></table></div>
  ${mfInv>0?`<div style="margin-top:10px;padding:11px 14px;background:var(--section-bg);border-radius:7px;border:1px solid var(--border);font-size:12.5px"><strong>MF Summary:</strong> Invested: ${fmt(mfInv)} | Current: ${fmt(mfCur)} | P&L: <strong style="color:${mfCur>=mfInv?'var(--green)':'var(--red)'}">${mfCur>=mfInv?'+':''}${mfInv>0?((mfCur-mfInv)/mfInv*100).toFixed(2):0}%</strong></div>`:''}
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ“¦ ETF Portfolio Review</div>
  <div style="overflow-x:auto"><table class="rpt-table"><thead><tr><th>ETF Name</th><th>Type</th><th>Units</th><th>Avg Price</th><th>Curr Price</th><th>Value</th><th>Gain/Loss</th><th>Recommendation</th><th>Remarks</th></tr></thead><tbody>
    ${etfRows||'<tr><td colspan="9" style="color:var(--text-light);padding:14px">No ETFs entered.</td></tr>'}
  </tbody></table></div>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ“ˆ Stock Portfolio Review</div>
  <div style="overflow-x:auto"><table class="rpt-table"><thead><tr><th>Stock</th><th>Sector</th><th>Qty</th><th>Avg</th><th>Curr</th><th>Invested</th><th>Value</th><th>P&L%</th><th>Recommendation</th><th>Remarks</th></tr></thead><tbody>
    ${stRows||'<tr><td colspan="10" style="color:var(--text-light);padding:14px">No stocks entered.</td></tr>'}
  </tbody></table></div>
  ${stInv>0?`<div style="margin-top:10px;padding:11px 14px;background:var(--section-bg);border-radius:7px;border:1px solid var(--border);font-size:12px"><strong>Stock Summary:</strong> Invested: ${fmt(stInv)} | Current: ${fmt(stCur)} | Unrealised P&L: <strong style="color:${stCur>=stInv?'var(--green)':'var(--red)'}">${stCur>=stInv?'+':''}${stInv>0?((stCur-stInv)/stInv*100).toFixed(2):0}%</strong><br><span style="font-size:11px;color:var(--text-light)">ğŸ’¡ LTCG: Gains >â‚¹1L held >12 months taxed at 10%. Short-term at 15%. Consider tax harvesting before March 31.</span></div>`:''}
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ’¡ Personalised Recommendations</div>
  <div class="sug-grid">${sugs.map(s=>`<div class="sug-card ${s.p}"><div class="sug-badge">${s.b}</div><h4>${s.t}</h4><p>${s.d}</p></div>`).join('')}</div>
</div>

<div class="rpt-section">
  <div class="rpt-section-title">ğŸ“… Prioritised Action Plan</div>
  <table class="rpt-table"><thead><tr><th>#</th><th>Action</th><th>Category</th><th>Priority</th><th>Timeline</th><th>Benefit</th></tr></thead><tbody>
    ${actions.map(a=>`<tr><td>${a[0]}</td><td><strong>${a[1]}</strong></td><td style="font-size:11px">${a[2]}</td><td>${a[3]}</td><td style="font-size:11px">${a[4]}</td><td style="font-size:11px">${a[5]}</td></tr>`).join('')}
  </tbody></table>
</div>

<div class="disc-box">
  <strong>Comprehensive Disclaimer:</strong><br><br>
  <strong>1. Not SEBI-Registered:</strong> Sekhar Financial Services is NOT registered under SEBI (Investment Advisers) Regulations, 2013. This report does not constitute regulated financial advice.<br>
  <strong>2. Educational Purpose Only:</strong> All projections are indicative, based on assumed inflation rates and investment returns. Actual results may vary significantly.<br>
  <strong>3. No Guarantee of Returns:</strong> Investments in mutual funds, ETFs and equities are subject to market risk. Past performance does not guarantee future results.<br>
  <strong>4. Insurance Suggestions:</strong> Product recommendations are general in nature. Premiums, terms, and eligibility vary by insurer. Verify independently before purchasing.<br>
  <strong>5. Data Privacy:</strong> This report was generated for the named client only. Your data is protected under our Privacy Policy and will not be shared with third parties.<br>
  <strong>6. Consult a Professional:</strong> For regulated investment advice, consult a SEBI Registered Investment Adviser. For insurance, consult a licensed insurance broker.<br><br>
  <em>"Every financial decision ultimately impacts the people who depend on you." | "You may be one person in the world, but to your family, you are their whole world."</em>
</div>
</div>
`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function adminNav(panel) {
  document.querySelectorAll('.admin-nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
  event.currentTarget?.classList.add('active');
  document.getElementById('panel-' + panel)?.classList.add('active');
  const titles = { overview:'Overview', users:'All Users', reports:'All Reports', revenue:'Revenue & Subscriptions', payments:'Report Payments (â‚¹199/report)', settings:'Setup Guide â€” Google Sheets & UPI' };
  document.getElementById('admin-page-title').textContent = titles[panel] || 'Admin';
  if (panel === 'payments') loadPaymentsPanel();
  if (panel === 'settings') loadSettingsPanel();
}

function loadAdminDash() {
  const session = DB.getSession();
  document.getElementById('admin-username-display').textContent = session?.name || 'Admin';
  const users = DB.getUsers();
  const userList = Object.values(users).filter(u => u.role !== 'admin');
  const premUsers = userList.filter(u => u.plan !== 'free');

  document.getElementById('admin-stats-grid').innerHTML = [
    {icon:'ğŸ‘¥',label:'Total Users',value:userList.length,change:'Registered users'},
    {icon:'â­',label:'Premium Users',value:premUsers.length,change:`${userList.length>0?((premUsers.length/userList.length)*100).toFixed(0):0}% conversion`},
    {icon:'ğŸ“‹',label:'Total Assessments',value:userList.reduce((a,u)=>a+(u.assessments||0),0),change:'Completed assessments'},
    {icon:'ğŸ“Š',label:'Avg Health Score',value:(userList.filter(u=>u.score).length>0?(userList.reduce((a,u)=>a+(u.score||0),0)/userList.filter(u=>u.score).length).toFixed(0):0)+'/100',change:'Across all clients'},
  ].map(s=>`<div class="stat-card"><div class="sc-icon">${s.icon}</div><div class="sc-label">${s.label}</div><div class="sc-value">${s.value}</div><div class="sc-change">${s.change}</div></div>`).join('');

  const renderUserRow = (u) => {
    const scoreClass = !u.score?'':u.score>=70?'score-high':u.score>=45?'score-mid':'score-low';
    return `<tr>
      <td><div class="user-name">${u.name}</div><div class="user-email">${u.email}</div></td>
      <td>${u.email}</td>
      <td>${u.mobile||'â€”'}</td>
      <td>${new Date(u.registered).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'})}</td>
      <td>${u.lastLogin?new Date(u.lastLogin).toLocaleDateString('en-IN',{day:'2-digit',month:'short'}):'Never'}</td>
      <td><span class="status-pill ${u.plan==='free'?'status-free':'status-premium'}">${u.plan.toUpperCase()}</span></td>
      <td><span class="score-chip ${scoreClass}">${u.score?u.score+'/100':'â€”'}</span></td>
      <td>${u.assessments||0}</td>
      <td style="display:flex;gap:6px">
        <button class="btn-admin-view" onclick="showUserDetail('${u.email}')">View</button>
        <button class="btn-admin-upgrade" onclick="adminUpgrade('${u.email}')">Upgrade</button>
        <button class="btn-admin-delete" onclick="adminDelete('${u.email}')">Del</button>
      </td>
    </tr>`;
  };

  const recentUsers = [...userList].sort((a,b)=>new Date(b.registered)-new Date(a.registered)).slice(0,10);
  document.getElementById('recent-reg-count').textContent = `${userList.length} total registered`;
  document.getElementById('recent-users-tbody').innerHTML = recentUsers.map(u => renderUserRow(u)).join('') || '<tr><td colspan="6" style="padding:20px;color:var(--text-light);text-align:center">No users registered yet.</td></tr>';
  document.getElementById('all-users-tbody').innerHTML = userList.map(u => renderUserRow(u)).join('') || '<tr><td colspan="9" style="padding:20px;color:var(--text-light);text-align:center">No users yet.</td></tr>';

  // Reports table
  const allReports = userList.filter(u=>u.score).map(u=>{
    const ud = DB.getUserData(u.email);
    const lr = ud.lastReport || {};
    return `<tr><td><strong>${u.name}</strong></td><td>${u.lastLogin?new Date(u.lastLogin).toLocaleDateString('en-IN'):'â€”'}</td><td style="font-weight:600;color:${(u.score||0)>=70?'var(--green)':(u.score||0)>=45?'var(--orange)':'var(--red)'}">${u.score||'â€”'}/100</td><td>${lr.surplus?fmt(lr.surplus):'â€”'}</td><td>${lr.corpus?fmt(lr.corpus):'â€”'}</td><td>${ud.formData?.ins_sa?fmt(parseFloat(ud.formData.ins_sa)):'â€”'}</td><td>${ud.formData?.ins_hc?fmt(parseFloat(ud.formData.ins_hc)):'â€”'}</td><td><span class="status-pill ${u.plan==='free'?'status-free':'status-premium'}">${u.plan.toUpperCase()}</span></td><td><button class="btn-admin-view" onclick="showUserDetail('${u.email}')">View</button></td></tr>`;
  });
  document.getElementById('all-reports-tbody').innerHTML = allReports.join('') || '<tr><td colspan="9" style="padding:20px;color:var(--text-light);text-align:center">No reports generated yet.</td></tr>';

  // Revenue
  const mrr = premUsers.filter(u=>u.plan==='professional').length * 999/12 + premUsers.filter(u=>u.plan==='elite').length * 2999/12;
  document.getElementById('rev-mrr').textContent = 'â‚¹' + Math.round(mrr).toLocaleString('en-IN');
  document.getElementById('rev-premium').textContent = premUsers.length;
  document.getElementById('rev-conv').textContent = userList.length>0?((premUsers.length/userList.length)*100).toFixed(0)+'%':'0%';
  document.getElementById('revenue-tbody').innerHTML = premUsers.map(u=> {
    const ud = DB.getUserData(u.email);
    const expiry = ud.planExpiry ? new Date(ud.planExpiry).toLocaleDateString('en-IN') : 'â€”';
    const started = ud.planActivated ? new Date(ud.planActivated).toLocaleDateString('en-IN') : new Date(u.registered).toLocaleDateString('en-IN');
    return `<tr><td><strong>${u.name}</strong></td><td>${u.email}</td><td><span class="status-pill status-premium">${u.plan.toUpperCase()}</span></td><td>${started}</td><td>${expiry}</td><td>â‚¹${u.plan==='professional'?'999':'2,999'}</td><td><span class="status-pill status-active">Active</span></td></tr>`;
  }).join('') || '<tr><td colspan="7" style="padding:20px;text-align:center;color:var(--text-light)">No premium subscribers yet.</td></tr>';

  // Pending subscription requests
  const allPending = [];
  userList.forEach(u => {
    const reqs = (u.subscriptionRequests || []).filter(r => r.status === 'pending');
    reqs.forEach(r => allPending.push({ ...r, userName: u.name, userEmail: u.email }));
  });
  document.getElementById('rev-pending').textContent = allPending.length;
  document.getElementById('pending-requests-tbody').innerHTML = allPending.length ? allPending.map(r => `
    <tr>
      <td><strong>${r.userName}</strong></td>
      <td style="font-size:12px">${r.userEmail}</td>
      <td><span class="status-pill status-premium">${r.plan.toUpperCase()}</span></td>
      <td>${r.mobile || 'â€”'}</td>
      <td style="font-size:12px">${new Date(r.requestedAt).toLocaleDateString('en-IN', {day:'2-digit',month:'short',year:'numeric'})}</td>
      <td style="font-size:11.5px;max-width:140px;color:var(--text-light)">${r.message || 'â€”'}</td>
      <td>
        <button class="btn-admin-upgrade" onclick="adminActivateSub('${r.userEmail}','${r.plan}')" style="background:var(--green);color:white;border:none;padding:5px 11px;border-radius:5px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif">
          âœ… Activate
        </button>
      </td>
    </tr>`).join('') : '<tr><td colspan="7" style="padding:20px;text-align:center;color:var(--text-light)">No pending subscription requests.</td></tr>';
}

function filterUsers(query) {
  const users = DB.getUsers();
  const filtered = Object.values(users).filter(u => u.role !== 'admin' && (u.name.toLowerCase().includes(query.toLowerCase()) || u.email.toLowerCase().includes(query.toLowerCase())));
  document.getElementById('all-users-tbody').innerHTML = filtered.map(u => {
    const scoreClass = !u.score?'':u.score>=70?'score-high':u.score>=45?'score-mid':'score-low';
    return `<tr><td><div class="user-name">${u.name}</div></td><td>${u.email}</td><td>${u.mobile||'â€”'}</td><td>${new Date(u.registered).toLocaleDateString('en-IN')}</td><td>${u.lastLogin?new Date(u.lastLogin).toLocaleDateString('en-IN'):'Never'}</td><td><span class="status-pill ${u.plan==='free'?'status-free':'status-premium'}">${u.plan.toUpperCase()}</span></td><td><span class="score-chip ${scoreClass}">${u.score?u.score+'/100':'â€”'}</span></td><td>${u.assessments||0}</td><td><button class="btn-admin-view" onclick="showUserDetail('${u.email}')">View</button><button class="btn-admin-upgrade" onclick="adminUpgrade('${u.email}')" style="margin-left:6px">Upgrade</button></td></tr>`;
  }).join('') || '<tr><td colspan="9" style="padding:20px;text-align:center;color:var(--text-light)">No matching users.</td></tr>';
}

function showUserDetail(email) {
  const users = DB.getUsers();
  const u = users[email];
  const ud = DB.getUserData(email);
  const d = ud.formData || {};
  const lr = ud.lastReport || {};
  document.getElementById('modal-client-name').textContent = u.name;
  const fmt2 = (k) => d[k] ? fmt(parseFloat(d[k])) : 'â€”';
  document.getElementById('modal-body-content').innerHTML = `
    <div class="modal-section"><h4>Account Details</h4>
      <div class="modal-kv-grid">
        <div class="modal-kv"><div class="mk-label">Name</div><div class="mk-value">${u.name}</div></div>
        <div class="modal-kv"><div class="mk-label">Email</div><div class="mk-value">${u.email}</div></div>
        <div class="modal-kv"><div class="mk-label">Mobile</div><div class="mk-value">${u.mobile||'â€”'}</div></div>
        <div class="modal-kv"><div class="mk-label">Registered</div><div class="mk-value">${new Date(u.registered).toLocaleDateString('en-IN')}</div></div>
        <div class="modal-kv"><div class="mk-label">Plan</div><div class="mk-value" style="color:var(--gold);font-weight:700">${u.plan.toUpperCase()}</div></div>
        <div class="modal-kv"><div class="mk-label">Health Score</div><div class="mk-value" style="color:var(--green);font-weight:700">${u.score?u.score+'/100':'Not assessed'}</div></div>
      </div>
    </div>
    <div class="modal-section"><h4>Financial Overview</h4>
      <div class="modal-kv-grid">
        <div class="modal-kv"><div class="mk-label">Monthly Salary</div><div class="mk-value">${fmt2('i_sal')}</div></div>
        <div class="modal-kv"><div class="mk-label">Monthly Expenses</div><div class="mk-value">${d.e_hh?fmt(parseFloat(d.e_hh)+parseFloat(d.e_edu||0)+parseFloat(d.e_med||0)+parseFloat(d.e_life||0)):'â€”'}</div></div>
        <div class="modal-kv"><div class="mk-label">Monthly Surplus</div><div class="mk-value" style="color:var(--green)">${lr.surplus?fmt(lr.surplus):'â€”'}</div></div>
        <div class="modal-kv"><div class="mk-label">Life Insurance SA</div><div class="mk-value">${fmt2('ins_sa')}</div></div>
        <div class="modal-kv"><div class="mk-label">Health Cover</div><div class="mk-value">${fmt2('ins_hc')}</div></div>
        <div class="modal-kv"><div class="mk-label">Total Corpus</div><div class="mk-value">${lr.corpus?fmt(lr.corpus):'â€”'}</div></div>
        <div class="modal-kv"><div class="mk-label">Emergency Fund</div><div class="mk-value">${fmt2('r_efa')}</div></div>
        <div class="modal-kv"><div class="mk-label">Home Loan EMI</div><div class="mk-value">${fmt2('l_hemi')}</div></div>
        <div class="modal-kv"><div class="mk-label">Risk Profile</div><div class="mk-value">${d.inv_risk||'â€”'}</div></div>
      </div>
    </div>
    <div class="modal-section"><h4>Assessment History</h4>
      <p style="font-size:12.5px;color:var(--text-mid)">${(ud.history||[]).length} assessment(s) completed. ${u.assessments||0} total.</p>
    </div>
    <div style="display:flex;gap:10px;margin-top:16px">
      <button class="btn-admin-upgrade" onclick="adminUpgrade('${email}');closeModal()">Upgrade Plan</button>
      <button class="btn-admin-delete" onclick="adminDelete('${email}');closeModal()">Delete Account</button>
      <button style="background:var(--section-bg);border:1px solid var(--border);padding:7px 14px;border-radius:6px;font-size:12.5px;cursor:pointer" onclick="closeModal()">Close</button>
    </div>
  `;
  document.getElementById('userModal').classList.add('show');
}

function closeModal() { document.getElementById('userModal').classList.remove('show'); }

function adminUpgrade(email) {
  const plan = prompt('Enter plan (professional / elite):');
  if (!plan || !['professional','elite','free'].includes(plan)) return;
  const users = DB.getUsers();
  users[email].plan = plan;
  DB.saveUsers(users);
  alert(`âœ… ${users[email].name} upgraded to ${plan.toUpperCase()}`);
  loadAdminDash();
}

function adminUpgrade(email) {
  const plan = prompt('Enter plan to activate (professional / elite / free):');
  if (!plan || !['professional','elite','free'].includes(plan)) return;
  adminActivateSub(email, plan);
}

function adminDelete(email) {
  if (!confirm(`Are you sure you want to permanently delete account: ${email}?\n\nThis action cannot be undone and all data will be lost.`)) return;
  const users = DB.getUsers();
  delete users[email];
  DB.saveUsers(users);
  localStorage.removeItem('sfs_data_' + btoa(email));
  alert('âœ… Account deleted successfully.');
  loadAdminDash();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAYMENTS PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadPaymentsPanel() {
  const payments = DB.getPayments();
  const total    = payments.reduce((s, p) => s + (p.amount || 0), 0);
  const pending  = payments.filter(p => p.status === 'pending_verification').length;
  const verified = payments.filter(p => p.status === 'verified').length;
  document.getElementById('pay-total').textContent   = 'â‚¹' + total.toLocaleString('en-IN');
  document.getElementById('pay-count').textContent   = payments.length;
  document.getElementById('pay-pending').textContent = pending;
  document.getElementById('pay-verified').textContent = verified;
  document.getElementById('payments-tbody').innerHTML = payments.length === 0
    ? '<tr><td colspan="9" style="padding:20px;text-align:center;color:var(--text-light)">No payment records yet. Users pay â‚¹199 to generate reports.</td></tr>'
    : [...payments].reverse().map((p, i) => {
        const ri = payments.length - 1 - i; // real index for verify action
        return `<tr>
          <td><strong>${p.name}</strong></td>
          <td style="font-size:12px">${p.email}</td>
          <td>${p.mobile || 'â€”'}</td>
          <td style="font-family:'DM Mono',monospace;font-weight:700;color:var(--green)">â‚¹${p.amount}</td>
          <td style="font-family:'DM Mono',monospace;font-size:12px;color:var(--navy)">${p.utr}</td>
          <td style="font-size:11.5px;color:var(--text-light)">${p.upi_id || APP_CONFIG.UPI_ID}</td>
          <td style="font-size:11.5px">${new Date(p.date).toLocaleString('en-IN',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'})}</td>
          <td>
            <span style="padding:3px 9px;border-radius:20px;font-size:11px;font-weight:700;
              background:${p.status==='verified'?'#ecfdf5':p.status==='rejected'?'#fef2f2':'#fff7ed'};
              color:${p.status==='verified'?'#065f46':p.status==='rejected'?'#991b1b':'#9a3412'}">
              ${p.status==='verified'?'âœ… Verified':p.status==='rejected'?'âŒ Rejected':'â³ Pending'}
            </span>
          </td>
          <td style="display:flex;gap:5px">
            <button onclick="verifyPayment(${ri},'verified')"  style="background:var(--green);color:#fff;border:none;padding:4px 9px;border-radius:5px;font-size:11px;cursor:pointer">âœ…</button>
            <button onclick="verifyPayment(${ri},'rejected')" style="background:var(--red);color:#fff;border:none;padding:4px 9px;border-radius:5px;font-size:11px;cursor:pointer">âŒ</button>
          </td>
        </tr>`;
      }).join('');
}

function verifyPayment(idx, status) {
  const payments = DB.getPayments();
  if (!payments[idx]) return;
  payments[idx].status = status;
  payments[idx].verifiedAt = new Date().toISOString();
  DB.savePayments(payments);
  loadPaymentsPanel();
}

function exportPaymentsCSV() {
  const payments = DB.getPayments();
  if (payments.length === 0) { alert('No payments to export yet.'); return; }
  const header = ['Name','Email','Mobile','Amount','UTR','UPI ID','Date','Status'];
  const rows   = payments.map(p => [
    p.name, p.email, p.mobile || '', p.amount, p.utr,
    p.upi_id || APP_CONFIG.UPI_ID,
    new Date(p.date).toLocaleString('en-IN'),
    p.status
  ]);
  const csv  = [header, ...rows].map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const a    = document.createElement('a');
  a.href     = URL.createObjectURL(blob);
  a.download = `SFS_Payments_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS PANEL â€” show live config values
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettingsPanel() {
  const upiEl    = document.getElementById('cfg-upi');
  const nameEl   = document.getElementById('cfg-upi-name');
  const priceEl  = document.getElementById('cfg-price');
  const sheetEl  = document.getElementById('cfg-sheets-status');
  const warnEl   = document.getElementById('cfg-warning');
  if (upiEl)   upiEl.textContent   = APP_CONFIG.UPI_ID;
  if (nameEl)  nameEl.textContent  = APP_CONFIG.UPI_NAME;
  if (priceEl) priceEl.textContent = 'â‚¹' + APP_CONFIG.REPORT_PRICE;
  const sheetsOk = APP_CONFIG.SHEETS_WEBHOOK !== 'YOUR_APPS_SCRIPT_WEBHOOK_URL';
  if (sheetEl) {
    sheetEl.textContent = sheetsOk ? 'âœ… Connected' : 'âŒ Not configured';
    sheetEl.style.color = sheetsOk ? 'var(--green)' : 'var(--red)';
  }
  if (warnEl) warnEl.style.display = sheetsOk ? 'none' : 'block';
}

function copyAppsScript() {
  const code = document.getElementById('apps-script-code')?.textContent || '';
  navigator.clipboard?.writeText(code).then(() => {
    const btn = document.getElementById('copy-as-btn');
    if (btn) { btn.textContent = 'âœ… Copied!'; setTimeout(() => btn.textContent = 'ğŸ“‹ Copy Script', 2500); }
  });
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT â€” Check existing session on page load
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function init() {
  const sess = DB.getSession();
  if (!sess || !sess.email) {
    showScreen('screen-landing');
    return;
  }
  const users = DB.getUsers();
  const user = users[sess.email];
  if (!user) {
    DB.clearSession();
    showScreen('screen-landing');
    return;
  }
  currentUser = user;
  if (user.role === 'admin') { loadAdminDash(); showScreen('screen-admin'); }
  else { loadUserDash(); showScreen('screen-dashboard'); }
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAYMENT GATE MODAL â€” â‚¹199 per report via UPI
     QR code + UPI ID + UTR verification
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<div id="payGateModal" style="display:none;position:fixed;inset:0;background:rgba(10,22,40,.78);z-index:4000;align-items:center;justify-content:center;padding:16px;overflow-y:auto">
  <div style="background:#fff;border-radius:20px;max-width:500px;width:100%;box-shadow:0 24px 80px rgba(0,0,0,.5);overflow:hidden;margin:auto">

    <!-- Header -->
    <div style="background:linear-gradient(135deg,#0a1628,#1a3460);padding:18px 22px;display:flex;align-items:center;justify-content:space-between">
      <div>
        <div style="color:rgba(255,255,255,.5);font-size:10px;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:3px">Sekhar Financial Services</div>
        <h3 style="color:#fff;font-family:'Playfair Display',serif;font-size:18px;margin:0">Unlock Your Report</h3>
      </div>
      <button onclick="closePayGate()" style="background:rgba(255,255,255,.1);border:none;color:rgba(255,255,255,.7);width:32px;height:32px;border-radius:50%;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center">âœ•</button>
    </div>

    <div style="padding:20px 22px">

      <!-- What you get -->
      <div style="background:#f8f5ee;border-left:4px solid #c9a84c;border-radius:0 9px 9px 0;padding:12px 14px;margin-bottom:18px;font-size:12px;color:#3d3d5c;line-height:1.85">
        <strong style="color:#0a1628;font-size:12.5px">ğŸ“‹ Your report includes:</strong><br>
        âœ… Financial Health Score Â· âœ… Emergency & Insurance Gap Analysis<br>
        âœ… MF/ETF/Stock Buy-Hold-Sell signals Â· âœ… Education SIP Planner<br>
        âœ… Goal-wise SIP calculator Â· âœ… 12-point Action Plan Â· âœ… Tax tips
      </div>

      <!-- Price -->
      <div style="text-align:center;margin-bottom:18px">
        <div style="display:inline-flex;align-items:baseline;gap:6px;background:linear-gradient(135deg,#c9a84c,#e8c878);padding:10px 28px;border-radius:50px">
          <span style="font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:#0a1628">â‚¹199</span>
          <span style="font-size:12px;color:rgba(10,22,40,.65)">one-time per report</span>
        </div>
      </div>

      <!-- Tabs -->
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;border:1.5px solid #e2d9c5;border-radius:9px;overflow:hidden;margin-bottom:18px">
        <div id="pg-tab-qr"  onclick="_pgSwitchTab('qr')"  style="padding:10px;text-align:center;font-size:12.5px;font-weight:600;cursor:pointer;background:#0a1628;color:#fff;transition:all .2s">ğŸ“± Scan QR</div>
        <div id="pg-tab-upi" onclick="_pgSwitchTab('upi')" style="padding:10px;text-align:center;font-size:12.5px;font-weight:600;cursor:pointer;background:transparent;color:#6b6b8a;transition:all .2s">ğŸ’³ UPI ID</div>
        <div id="pg-tab-utr" onclick="_pgSwitchTab('utr')" style="padding:10px;text-align:center;font-size:12.5px;font-weight:600;cursor:pointer;background:transparent;color:#6b6b8a;transition:all .2s">âœ… Enter UTR</div>
      </div>

      <!-- QR panel -->
      <div id="pg-panel-qr">
        <div style="text-align:center;padding:8px 0 14px">
          <div style="display:inline-block;padding:10px;background:#fff;border:2px solid #e2d9c5;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.08)">
            <canvas id="qrCanvas" width="200" height="200"></canvas>
          </div>
          <div style="margin-top:10px;font-size:12px;color:#6b6b8a">Scan with PhonePe Â· GPay Â· Paytm Â· BHIM</div>
          <div id="pg-upi-show" style="margin-top:5px;font-family:'DM Mono',monospace;font-size:14px;font-weight:700;color:#0a1628"></div>
          <div style="margin-top:4px;font-size:13px;font-weight:700;color:#c9a84c">Amount: â‚¹199</div>
        </div>
      </div>

      <!-- UPI ID panel -->
      <div id="pg-panel-upi" style="display:none">
        <div style="background:#eff6ff;border:1px solid #bfdbfe;border-radius:10px;padding:18px;text-align:center;margin-bottom:14px">
          <div style="font-size:11px;font-weight:700;color:#1e40af;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">Send â‚¹199 to this UPI ID</div>
          <div id="pg-upi-id-text" style="font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:#0a1628;letter-spacing:.5px;word-break:break-all"></div>
          <button onclick="pgCopyUPI()" style="margin-top:12px;background:#0a1628;color:#fff;border:none;padding:8px 20px;border-radius:7px;font-size:12.5px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600">ğŸ“‹ Copy UPI ID</button>
          <div id="pg-copy-confirm" style="display:none;color:#065f46;font-size:11.5px;margin-top:6px;font-weight:600">âœ“ Copied to clipboard!</div>
        </div>
        <div style="background:#fefce8;border:1px solid #fde047;border-radius:8px;padding:10px 13px;font-size:12px;color:#713f12;text-align:center">
          After paying, go to <strong>Enter UTR tab</strong> and enter your transaction ID
        </div>
      </div>

      <!-- UTR panel -->
      <div id="pg-panel-utr" style="display:none">
        <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:9px;padding:13px 15px;margin-bottom:14px;font-size:12.5px;color:#14532d">
          âœ… Paid? Enter the <strong>UTR / Transaction ID</strong> from your UPI app (usually 12 digits). Your report generates instantly.
        </div>
        <div style="margin-bottom:14px">
          <label style="font-size:10.5px;font-weight:700;color:#3d3d5c;text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:6px">UTR / Transaction ID *</label>
          <input id="pg-utr" type="text" placeholder="e.g. 425612345678" maxlength="22"
            style="width:100%;padding:12px 14px;border:2px solid #e2d9c5;border-radius:8px;font-size:16px;font-family:'DM Mono',monospace;outline:none;letter-spacing:.5px;transition:.2s"
            onfocus="this.style.borderColor='#c9a84c'" onblur="this.style.borderColor='#e2d9c5'"
            onkeydown="if(event.key==='Enter')handlePayGate()">
        </div>
        <div style="font-size:11.5px;color:#6b6b8a;margin-bottom:14px">
          ğŸ“± Find UTR in: GPay â†’ Transaction history â†’ Details &nbsp;|&nbsp; PhonePe â†’ History â†’ See details
        </div>
      </div>

      <!-- Action button -->
      <button id="pg-action-btn" onclick="handlePayGate()"
        style="width:100%;padding:14px;background:linear-gradient(135deg,#c9a84c,#e8c878);color:#0a1628;font-weight:700;font-size:15px;border:none;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;letter-spacing:.2px;margin-top:6px;transition:all .2s">
        ğŸš€ I've Paid â€” Generate My Report
      </button>
      <p style="font-size:11px;color:#6b6b8a;text-align:center;margin-top:8px">
        Payment verified instantly Â· Secure Â· No refunds after report generation
      </p>

      <!-- Success -->
      <div id="pg-success" style="display:none;background:#ecfdf5;border:1px solid #6ee7b7;border-radius:10px;padding:20px;text-align:center;margin-top:12px">
        <div style="font-size:36px;margin-bottom:8px">âœ…</div>
        <div style="font-weight:700;co